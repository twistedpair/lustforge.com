<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Using Immutable Objects with MyBatis &#183; </title><meta name=description content="Immutable is Beautiful
I’m a fan of immutable objects. We all know the benefits; simple, no mutators, thread safe, cache word optimizable. However, I see far too many MyBatis (and iBatis) developers adding no arg constructors to their POJO’s simply so that MyBatis can reflect and set all of the values into the field setters. I’ll ask “why does this POJO need to be mutated” and they quip that it doesn’t, but these setters and protected no-arg constructors are needed by MyBatis. This violates my principle that you make your library work with your code, not the other way around."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.140.2"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Using Immutable Objects with MyBatis"><meta property="og:description" content="Immutable is Beautiful
I’m a fan of immutable objects. We all know the benefits; simple, no mutators, thread safe, cache word optimizable. However, I see far too many MyBatis (and iBatis) developers adding no arg constructors to their POJO’s simply so that MyBatis can reflect and set all of the values into the field setters. I’ll ask “why does this POJO need to be mutated” and they quip that it doesn’t, but these setters and protected no-arg constructors are needed by MyBatis. This violates my principle that you make your library work with your code, not the other way around."><meta property="og:type" content="article"><meta property="og:url" content="https://lust.dev/2014/10/12/using-immutable-objects-with-mybatis/"><link rel=stylesheet href=https://lust.dev/dist/site.css><link rel=stylesheet href=https://lust.dev/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script async src="https://www.googletagmanager.com/gtag/js?id=G-W625CVG5Q9"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W625CVG5Q9")}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Twitter aria-label=Twitter href=https://twitter.com/lustcoder rel=me><i class="fa fa-twitter" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/twistedpair rel=me><i class="fa fa-github-alt" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint="Stack Overflow" aria-label="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust rel=me><i class="fa fa-stack-overflow" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://linkedin.com/in/josephlust rel=me><i class="fa fa-linkedin" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=../../../../>Blog</a></li><li class=site-nav-item><a href=../../../../tags>Tags</a></li><li class=site-nav-item><a href=../../../../about>About J. Lust</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Using Immutable Objects with MyBatis</h1><p class=post-date><span>Published <time datetime=2014-10-12 itemprop=datePublished>12 Oct '14</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=# itemprop=url rel=author>Joseph Lust</a></span></span></p><p class="post-reading post-line"><span>⏰ 2 min read</span></p></header><div class="post-content clearfix" itemprop=articleBody><h3 id=immutable-is-beautiful>Immutable is Beautiful</h3><p>I’m a fan of immutable objects. We all know the benefits; simple, no mutators, thread safe, cache word optimizable. However, I see far too many MyBatis (and iBatis) developers adding no arg constructors to their POJO’s simply so that MyBatis can reflect and set all of the values into the field setters. I’ll ask “<em>why does this POJO need to be mutated</em>” and they quip that it doesn’t, but these setters and protected no-arg constructors are needed by MyBatis. This violates my principle that you make your library work with your code, not the other way around.</p><p>Given the lack of good documentation on immutable objects in MyBatis, I hope the following helps folks.</p><h3 id=example-implementation>Example Implementation</h3><p>We need a <strong>ResultMap</strong> that will tell MyBatis how to map this to a constructor. This is because Java reflection only exposes the constructor parameter types and order, not the names of the parameters (so claim the MyBatis docs, though Spring somehow manages to do this with bean constructors…).</p><p>The mapper maps the column names returned in the query to the types on the constructor. It also lays out the order of the arguments. Make sure the constructor argument order exactly matches that of your POJO.</p><p><strong>Note:</strong> underscores before types map to the primitive value. <strong>_long</strong> maps to the primitive long type. <strong>long</strong> maps to the wrapper type java.lang.Long.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;resultMap</span>  <span class=na>id=</span><span class=s>&#34;fooViewMap&#34;</span> <span class=na>type=</span><span class=s>&#34;com.lustforge.FooView&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;constructor&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;arg</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>javaType=</span><span class=s>&#34;_long&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;arg</span> <span class=na>column=</span><span class=s>&#34;is_dirty&#34;</span>	<span class=na>javaType=</span><span class=s>&#34;_boolean&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;/constructor&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>Now make sure your query block points to the mapper via its <strong>resultMap</strong> attribute. Again confirm that the column names returned <strong>exactly match those in the map</strong>. <strong>Note:</strong> the order does not need to match for the query.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;getFooViews&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;fooViewMap&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>&lt;![CDATA[
</span></span></span><span class=line><span class=cl><span class=cp>	    SELECT 
</span></span></span><span class=line><span class=cl><span class=cp>   		foo.id
</span></span></span><span class=line><span class=cl><span class=cp>   		foo.is_dirty
</span></span></span><span class=line><span class=cl><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>		FROM foo
</span></span></span><span class=line><span class=cl><span class=cp>		-- your query here
</span></span></span><span class=line><span class=cl><span class=cp>	 ]]&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>Finally make sure your POJO constructor matches. It’s also a good idea to leave a note to future developers to update MyBatis if they alter the constructor argument types or order.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>FooView</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isDirty</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Prescient comment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// NOTE: MyBatis depends on parameter order and type for object creation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// If you change the constructor, update the MyBatis mapper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=nf>FooView</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isDirty</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=kd>super</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>this</span><span class=p>.</span><span class=na>isDirty</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>isDirty</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=nf>getId</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>return</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isDirty</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>return</span><span class=w> </span><span class=n>isDirty</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ... don&#39;t forget equals/hashcode and toString as well</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>That was easy and now you’re using best practices. Pat yourself on the back and get busy with your new immutable POJO.</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=../../../../tags/ibatis/>iBatis</a>,
<a href=../../../../tags/mybatis/>MyBatis</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Using%20Immutable%20Objects%20with%20MyBatis&url=https%3a%2f%2flust.dev%2f2014%2f10%2f12%2fusing-immutable-objects-with-mybatis%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' aria-label="Share on Twitter"><i class="fa fa-twitter" aria-hidden=true></i>
</a><a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flust.dev%2f2014%2f10%2f12%2fusing-immutable-objects-with-mybatis%2f" onclick='return window.open(this.href,"facebook-share","width=580,height=296"),!1' aria-label="Share on Facebook"><i class="fa fa-facebook" aria-hidden=true></i></a></div></footer><div class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//lustforge.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2024 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script><script src=https://lust.dev/js/jquery.fitvids.js></script><script src=https://lust.dev/js/scripts.js></script></body></html>