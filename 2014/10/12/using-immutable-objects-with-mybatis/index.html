<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Using Immutable Objects with MyBatis &#183; Joseph Lust</title><meta name=description content="a cloud engineering blog"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://lust.dev/favicon.png><link rel=stylesheet href=https://lust.dev/css/normalize.css><link rel=stylesheet href=https://lust.dev/css/highlight/obsidian.css><link rel=stylesheet href=https://lust.dev/css/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css></head><body><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-17498476-1","auto"),ga("send","pageview"))</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=lust.dev href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml><i title="RSS Feed" class="fa fa-rss"></i></a>
<a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/lustcoder><i class="fa fa-twitter"></i></a>
<a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/twistedpair><i class="fa fa-github-alt"></i></a>
<a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust><i class="fa fa-stack-overflow"></i></a>
<a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/josephlust><i class="fa fa-linkedin"></i></a><h1 class=site-title style=margin-left:10px><a class=site-title data-hint=Lust title="Meet the groundskeeper" href=https://lust.dev/about/>J. Lust &#8250;</a></h1></div><ul class=site-nav></ul></div></header><div id=container><div class=container><article class=post-container><header class=post-header><h1 class=post-title>Using Immutable Objects with MyBatis</h1></header><div class="post-content clearfix"><div itemscope itemtype=http://schema.org/BlogPosting style=display:none><meta itemprop=mainEntityOfPage content="https://lust.dev/2014/10/12/using-immutable-objects-with-mybatis/"><meta itemprop=inLanguage content="en-US"><h1 itemprop=headline>Using Immutable Objects with MyBatis</h1><meta itemprop=name content="Using Immutable Objects with MyBatis"><meta itemprop=description content><meta itemprop=wordCount content="422"><meta itemprop=keywords content="iBatis,MyBatis"><meta itemprop=copyrightYear content="2014"><div itemprop=copyrightHolder itemscope itemtype=http://schema.org/Person><meta itemprop=name content="Joseph Lust"></div><div itemprop=image itemscope itemtype=http://schema.org/ImageObject><img itemprop=url src=https://lust.dev/img/lustforge_key_default.png alt=thumbnail><meta itemprop=width content="200"><meta itemprop=height content="200"></div><meta itemprop=datePublished content="2014-10-12"><meta itemprop=dateModified content="2014-10-12"><a itemprop=mainEntityOfPage href=../../../../ArticleLink></a><div itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=name content="Joseph Lust"></div><div itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="lust.dev"><a itemprop=url href=../../../../><span itemprop=logo itemscope itemtype=http://schema.org/ImageObject><img itemprop=image src=https://lust.dev/favicon.png>
<link itemprop=url href=https://lust.dev/favicon.png></span></a></div></div><h3 id=immutable-is-beautiful>Immutable is Beautiful</h3><p>I’m a fan of immutable objects. We all know the benefits; simple, no mutators, thread safe, cache word optimizable. However, I see far too many MyBatis (and iBatis) developers adding no arg constructors to their POJO’s simply so that MyBatis can reflect and set all of the values into the field setters. I’ll ask “<em>why does this POJO need to be mutated</em>” and they quip that it doesn’t, but these setters and protected no-arg constructors are needed by MyBatis. This violates my principle that you make your library work with your code, not the other way around.</p><p>Given the lack of good documentation on immutable objects in MyBatis, I hope the following helps folks.</p><h3 id=example-implementation>Example Implementation</h3><p>We need a <strong>ResultMap</strong> that will tell MyBatis how to map this to a constructor. This is because Java reflection only exposes the constructor parameter types and order, not the names of the parameters (so claim the MyBatis docs, though Spring somehow manages to do this with bean constructors…).</p><p>The mapper maps the column names returned in the query to the types on the constructor. It also lays out the order of the arguments. Make sure the constructor argument order exactly matches that of your POJO.</p><p><strong>Note:</strong> underscores before types map to the primitive value. <strong>_long</strong> maps to the primitive long type. <strong>long</strong> maps to the wrapper type java.lang.Long.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;resultMap</span>  <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;fooViewMap&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;com.lustforge.FooView&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;constructor&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;arg</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;_long&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;arg</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;is_dirty&#34;</span>	<span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;_boolean&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;/constructor&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>Now make sure your query block points to the mapper via its <strong>resultMap</strong> attribute. Again confirm that the column names returned <strong>exactly match those in the map</strong>. <strong>Note:</strong> the order does not need to match for the query.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getFooViews&#34;</span> <span style=color:#a6e22e>resultMap=</span><span style=color:#e6db74>&#34;fooViewMap&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#75715e>	    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#75715e>   		foo.id
</span></span></span><span style=display:flex><span><span style=color:#75715e>   		foo.is_dirty
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>		FROM foo
</span></span></span><span style=display:flex><span><span style=color:#75715e>		-- your query here
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><p>Finally make sure your POJO constructor matches. It’s also a good idea to leave a note to future developers to update MyBatis if they alter the constructor argument types or order.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FooView</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>boolean</span> isDirty<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Prescient comment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// NOTE: MyBatis depends on parameter order and type for object creation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// If you change the constructor, update the MyBatis mapper
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FooView</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> id<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isDirty<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>super</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>isDirty</span> <span style=color:#f92672>=</span> isDirty<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>getId</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isDirty</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> isDirty<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ... don&#39;t forget equals/hashcode and toString as well
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>That was easy and now you’re using best practices. Pat yourself on the back and get busy with your new immutable POJO.</p></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=lust.dev href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2009 - 2022 / Powered by <a href=http://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/twistedpair/ghostwriter>Lustwriter theme</a> By J. Lust</span>
<span>/ Forked from <a href=https://github.com/jbub/ghostwriter>Ghostwriter</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script>
<script src=https://lust.dev/js/jquery.fitvids.js></script>
<script src=https://lust.dev/js/scripts.js></script></body></html>