<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>AWS Hugo Hosting, HowTo &#183; Joseph Lust</title><meta name=description content="a cloud engineering blog"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://lust.dev/favicon.png><link rel=stylesheet href=https://lust.dev/css/normalize.css><link rel=stylesheet href=https://lust.dev/css/highlight/obsidian.css><link rel=stylesheet href=https://lust.dev/css/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css></head><body><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-17498476-1","auto"),ga("send","pageview"))</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=lust.dev href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml><i title="RSS Feed" class="fa fa-rss"></i></a>
<a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/lustcoder><i class="fa fa-twitter"></i></a>
<a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/twistedpair><i class="fa fa-github-alt"></i></a>
<a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust><i class="fa fa-stack-overflow"></i></a>
<a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/josephlust><i class="fa fa-linkedin"></i></a><h1 class=site-title style=margin-left:10px><a class=site-title data-hint=Lust title="Meet the groundskeeper" href=https://lust.dev/about/>J. Lust &#8250;</a></h1></div><ul class=site-nav></ul></div></header><div id=container><div class=container><article class=post-container><header class=post-header><h1 class=post-title>AWS Hugo Hosting, HowTo</h1></header><div class="post-content clearfix"><div itemscope itemtype=http://schema.org/BlogPosting style=display:none><meta itemprop=mainEntityOfPage content="https://lust.dev/2016/02/27/hosting-hugo-on-aws/"><meta itemprop=inLanguage content="en-US"><h1 itemprop=headline>AWS Hugo Hosting, HowTo</h1><meta itemprop=name content="AWS Hugo Hosting, HowTo"><meta itemprop=description content="Easily Host your Hugo static website on CloudFront with AWS CLI"><meta itemprop=wordCount content="1433"><meta itemprop=keywords content="Go,CloudFront,AWS,Hugo,S3"><meta itemprop=copyrightYear content="2016"><div itemprop=copyrightHolder itemscope itemtype=http://schema.org/Person><meta itemprop=name content="Joseph Lust"></div><div itemprop=image itemscope itemtype=http://schema.org/ImageObject><img itemprop=url src=https://lust.dev/img/lustforge_key_default.png alt=thumbnail><meta itemprop=width content="200"><meta itemprop=height content="200"></div><meta itemprop=datePublished content="2016-02-27"><meta itemprop=dateModified content="2016-02-27"><a itemprop=mainEntityOfPage href=../../../../ArticleLink></a><div itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=name content="Joseph Lust"></div><div itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="lust.dev"><a itemprop=url href=../../../../><span itemprop=logo itemscope itemtype=http://schema.org/ImageObject><img itemprop=image src=https://lust.dev/favicon.png>
<link itemprop=url href=https://lust.dev/favicon.png></span></a></div></div><p>Running your <a href=https://gohugo.io/>Hugo</a> static blog site is easy and cheap, but there are a few snags I had to solve when I deployed mine. Follow these instruction to host your Hugo blog on AWS <a href=https://aws.amazon.com/s3/>S3</a> and <a href=https://aws.amazon.com/cloudfront/>Cloudfront</a>.</p><h2 id=disclaimer>Disclaimer</h2><p>The following works for me. If you&rsquo;re not comfortable with a CLI, use the <a href=console.aws.amazon.com/console/home>AWS Web Console</a>.</p><h2 id=bucket-configuration>Bucket Configuration</h2><p>Other tutorials use the AWS web console, and feature lots of screenshots, but your&rsquo;re a savvy Hugo user. We&rsquo;ll use the AWS Commandline interface tool, ak.k. <strong>awscli</strong>. You can install it with <code>pip</code>, if you don&rsquo;t already have it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pip install awscli
</span></span><span style=display:flex><span>aws configure <span style=color:#75715e># Follow instructions to setup</span>
</span></span></code></pre></div><p>Make a bucket. The name does not matter. No one will see this. If someone is already using that name, you&rsquo;ll need to pick another. We&rsquo;ll also add a bucket to hold all of our <strong>logs</strong>, so that you can know who visited.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Set your domain here</span>
</span></span><span style=display:flex><span>YOUR_DOMAIN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yourdomain.com&#34;</span>
</span></span><span style=display:flex><span>REGION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Don&#39;t change these</span>
</span></span><span style=display:flex><span>BUCKET_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>YOUR_DOMAIN<span style=color:#e6db74>}</span><span style=color:#e6db74>-cdn&#34;</span>
</span></span><span style=display:flex><span>LOG_BUCKET_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUCKET_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>-logs&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># One fresh bucket please!</span>
</span></span><span style=display:flex><span>aws s3 mb s3://$BUCKET_NAME --region $REGION
</span></span><span style=display:flex><span><span style=color:#75715e># And another for the logs</span>
</span></span><span style=display:flex><span>aws s3 mb s3://$LOG_BUCKET_NAME --region $REGION
</span></span></code></pre></div><h2 id=bucket-permissions-and-logging>Bucket Permissions and Logging</h2><p>Give AWS the rights to insert logs into your bucket. Then tell S3 to log your website visits to that bucket.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Let AWS write the logs to this location</span>
</span></span><span style=display:flex><span>aws s3api put-bucket-acl --bucket $LOG_BUCKET_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--grant-write <span style=color:#e6db74>&#39;URI=&#34;http://acs.amazonaws.com/groups/s3/LogDelivery&#34;&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--grant-read-acp <span style=color:#e6db74>&#39;URI=&#34;http://acs.amazonaws.com/groups/s3/LogDelivery&#34;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Setup logging</span>
</span></span><span style=display:flex><span>LOG_POLICY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{\&#34;LoggingEnabled\&#34;:{\&#34;TargetBucket\&#34;:\&#34;</span>$LOG_BUCKET_NAME<span style=color:#e6db74>\&#34;,\&#34;TargetPrefix\&#34;:\&#34;</span>$BUCKET_NAME<span style=color:#e6db74>\&#34;}}&#34;</span>
</span></span><span style=display:flex><span>aws s3api put-bucket-logging --bucket $BUCKET_NAME --bucket-logging-status $LOG_POLICY
</span></span></code></pre></div><h2 id=create-s3-bucket-website>Create S3 Bucket Website</h2><p>We&rsquo;ll tell S3 to turn our bucket into a website. This will give it a public URL that does redirecting for us. We need this since Hugo blog pages like <strong>foo.com/bob/</strong> are really <strong>foo.com/bob/index.html</strong>. We need to redirect those root paths like <strong>/bob/</strong> to <strong>/bob/index.html</strong>. Normally you&rsquo;d need rewrite rules with Nginx or Apache, but S3 can do that too.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Create website config</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;IndexDocument\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Suffix\&#34;: \&#34;index.html\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;ErrorDocument\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Key\&#34;: \&#34;404.html\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;RoutingRules\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Redirect\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ReplaceKeyWith\&#34;: \&#34;index.html\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Condition\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;KeyPrefixEquals\&#34;: \&#34;/\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#34;</span> &gt; website.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws s3api put-bucket-website --bucket $BUCKET_NAME --website-configuration file://website.json
</span></span></code></pre></div><p>Now you can visit <code>http://&lt;bucket_name>.s3-website-&lt;region>.amazonaws.com</code> to browse your site!</p><h2 id=get-free-ssl-certificates>Get Free SSL Certificates</h2><p>Everything should have SSL, so AWS decided to give away <a href=https://aws.amazon.com/certificate-manager/pricing/>FREE SSL certificates</a> for all AWS users. Thanks, Jeff! Make sure you can access the admin email <a href=http://www.whois-search.com/>address on your domain</a>, and then run the following and check your email. The email should go through instantly. Note that we&rsquo;re also requesting the <code>www.</code> variant of this domain. We&rsquo;ll use this for redirecting <code>www.foo.com</code> to <code>foo.com</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws acm request-certificate --domain-name $YOUR_DOMAIN --subject-alternative-names <span style=color:#e6db74>&#34;www.</span>$YOUR_DOMAIN<span style=color:#e6db74>&#34;</span> --idempotency-token <span style=color:#e6db74>&#34;`date +%s`&#34;</span>
</span></span></code></pre></div><p>The idempotency token will prevent running this twice from sending two requests. Also, note that ACM will renew your certs each year automatically, so this SSL really is <a href=https://en.wikipedia.org/wiki/Ron_Popeil>set it and forget it</a>.</p><p>Call ACM and get the ARN of your cert to use in the next step.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws acm list-certificates --certificate-statuses ISSUED
</span></span><span style=display:flex><span><span style=color:#75715e># Example result</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;CertificateSummaryList&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;CertificateArn&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:acm:us-east-1:7865196219991:certificate/de305d54-75b4-431b-adb2-eb6b9e546014&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;DomainName&#34;</span>: <span style=color:#e6db74>&#34;yoursite.com&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=cloudfront-setup>CloudFront Setup</h2><p>S3 hosts your files as a website, but we want a vanity domain and custom SSL. Plus, a <a href=https://aws.amazon.com/cloudfront/details/#Detailed_Description>worldwide 54 edge location CDN</a> would be nice. AWS CloudFront can accomplish all of this quite easily.</p><p>First we&rsquo;ll tell <code>awscli</code> to enable the CloudFront tools, which are presently in &ldquo;Preview Mode.&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws  configure  set preview.cloudfront true <span style=color:#75715e># Honey badger don&#39;t care</span>
</span></span></code></pre></div><p>This is a long config, so let&rsquo;s break it down:</p><h4 id=origin-config>Origin Config</h4><p>We must use the <strong>S3 website hosting URL</strong> not simply point to the S3 bucket like regular CF setup. This allows us to get <strong>index.html</strong> redirecting. This also means we cannot use <strong>HTTPS Only</strong> on the origin, because its domain won&rsquo;t match the generic S3 certificate AWS uses for all S3 requests.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  <span style=color:#e6db74>&#34;Origins&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Items&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Id&#34;</span>: <span style=color:#e6db74>&#34;$BUCKET_NAME-origin&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;OriginPath&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;CustomOriginConfig&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;OriginProtocolPolicy&#34;</span>: <span style=color:#e6db74>&#34;http-only&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;HTTPPort&#34;</span>: <span style=color:#ae81ff>80</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;OriginSslProtocols&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Items&#34;</span>: [
</span></span><span style=display:flex><span>              <span style=color:#e6db74>&#34;TLSv1&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#e6db74>&#34;TLSv1.1&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#e6db74>&#34;TLSv1.2&#34;</span>
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;HTTPSPort&#34;</span>: <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;DomainName&#34;</span>: <span style=color:#e6db74>&#34;$BUCKET_NAME.s3-website-$REGION.amazonaws.com&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><h4 id=logging-config>Logging Config</h4><ul><li>Log CF hits to the buckets we already made</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;Logging&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Bucket&#34;</span>: <span style=color:#e6db74>&#34;$LOG_BUCKET_NAME.s3.amazonaws.com&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Prefix&#34;</span>: <span style=color:#e6db74>&#34;${BUCKET_NAME}-cf/&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Enabled&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=cache-behavior-config>Cache Behavior Config</h4><ul><li>We want everyone coming to the site to use SSL, so we&rsquo;ll redirect port 80 → 443.</li><li>Cache content for 30min by DefaultCacheBehavior</li><li>Only forward <code>HEAD</code> and <code>GET</code> requests, cache them too</li><li>Gzip content if possible (reduce bandwidth usage, faster)</li><li>Don&rsquo;t forward headers</li><li>Don&rsquo;t trust other signers</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;DefaultCacheBehavior&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span><span style=color:#f92672>&#34;DefaultCacheBehavior&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ViewerProtocolPolicy&#34;</span>: <span style=color:#e6db74>&#34;redirect-to-https&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;DefaultTTL&#34;</span>: <span style=color:#ae81ff>1800</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedMethods&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Items&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;HEAD&#34;</span>,<span style=color:#e6db74>&#34;GET&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;CachedMethods&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Items&#34;</span>: [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;HEAD&#34;</span>,<span style=color:#e6db74>&#34;GET&#34;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;MinTTL&#34;</span>: <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Compress&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ForwardedValues&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Headers&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Cookies&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Forward&#34;</span>: <span style=color:#e6db74>&#34;none&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;QueryString&#34;</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;TrustedSigners&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Enabled&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=ssl-config>SSL Config</h4><ul><li>Use the new SSL cert from ACM, referenced by the ARN</li><li>Use <a href=https://en.wikipedia.org/wiki/Server_Name_Indication>SNI</a>, breaking wood burning browsers on WinXP, because it&rsquo;s FREE</li><li>Warning: <strong>Not</strong> using SNI <a href=https://aws.amazon.com/cloudfront/pricing/#Request_Pricing_for_All_HTTP_Methods_(per_10,000)>costs <code>$600/mo</code></a>, so <strong>use SNI</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;ViewerCertificate&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;SSLSupportMethod&#34;</span>: <span style=color:#e6db74>&#34;sni-only&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ACMCertificateArn&#34;</span>: <span style=color:#e6db74>&#34;$SSL_ARN&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;MinimumProtocolVersion&#34;</span>: <span style=color:#e6db74>&#34;TLSv1&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Certificate&#34;</span>: <span style=color:#e6db74>&#34;$SSL_ARN&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;CertificateSource&#34;</span>: <span style=color:#e6db74>&#34;acm&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=error-config>Error Config</h4><ul><li>Forward Cloudfront <code>Not Found</code> and <code>Forbidden</code> errors to your custom pages</li><li>Cache failures for 5min, then try the Origin again</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;CustomErrorResponses&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Items&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ErrorCode&#34;</span>: <span style=color:#ae81ff>403</span>, 
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ResponsePagePath&#34;</span>: <span style=color:#e6db74>&#34;/404.html&#34;</span>, 
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ResponseCode&#34;</span>: <span style=color:#e6db74>&#34;404&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ErrorCachingMinTTL&#34;</span>: <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>        }, 
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ErrorCode&#34;</span>: <span style=color:#ae81ff>404</span>, 
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ResponsePagePath&#34;</span>: <span style=color:#e6db74>&#34;/404.html&#34;</span>, 
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ResponseCode&#34;</span>: <span style=color:#e6db74>&#34;404&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ErrorCachingMinTTL&#34;</span>: <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=redirect-config>Redirect Config</h4><ul><li>Mask the ugly default CF domain with your vanity domain</li><li>Accept root and <code>www.</code> variants</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;Aliases&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Quantity&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Items&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;$YOUR_DOMAIN&#34;</span>, <span style=color:#e6db74>&#34;www.$YOUR_DOMAIN&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=misc-config>Misc Config</h4><ul><li>Serve <code>foo.com/index.html</code> to <code>foo.com</code> requests</li><li>Use all edge nodes worldwide</li><li>Turn it on</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;DefaultRootObject&#34;</span>: <span style=color:#e6db74>&#34;index.html&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;PriceClass&#34;</span>: <span style=color:#e6db74>&#34;PriceClass_All&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Enabled&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=making-the-distribution>Making the Distribution</h3><p>Sorry, it&rsquo;s really ugly, but such is bash escaping.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># From above</span>
</span></span><span style=display:flex><span>SSL_ARN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;arn:aws:acm:us-east-1:7865196219991:certificate/de305d54-75b4-431b-adb2-eb6b9e546014&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CALLER_REF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;`date +%s`&#34;</span> <span style=color:#75715e># current second</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Comment\&#34;: \&#34;</span>$BUCKET_NAME<span style=color:#e6db74> Static Hosting\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Logging\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Bucket\&#34;: \&#34;</span>$LOG_BUCKET_NAME<span style=color:#e6db74>.s3.amazonaws.com\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Prefix\&#34;: \&#34;</span><span style=color:#e6db74>${</span>BUCKET_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>-cf/\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Enabled\&#34;: true,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;IncludeCookies\&#34;: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Origins\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Quantity\&#34;: 1,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Items\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Id\&#34;:\&#34;</span>$BUCKET_NAME<span style=color:#e6db74>-origin\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;OriginPath\&#34;: \&#34;\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;CustomOriginConfig\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;OriginProtocolPolicy\&#34;: \&#34;http-only\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;HTTPPort\&#34;: 80, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;OriginSslProtocols\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        \&#34;Quantity\&#34;: 3,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        \&#34;Items\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            \&#34;TLSv1\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            \&#34;TLSv1.1\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            \&#34;TLSv1.2\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;HTTPSPort\&#34;: 443
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;DomainName\&#34;: \&#34;</span>$BUCKET_NAME<span style=color:#e6db74>.s3-website-</span>$REGION<span style=color:#e6db74>.amazonaws.com\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;DefaultRootObject\&#34;: \&#34;index.html\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;PriceClass\&#34;: \&#34;PriceClass_All\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Enabled\&#34;: true, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;CallerReference\&#34;: \&#34;</span>$CALLER_REF<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;DefaultCacheBehavior\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;TargetOriginId\&#34;: \&#34;</span>$BUCKET_NAME<span style=color:#e6db74>-origin\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;ViewerProtocolPolicy\&#34;: \&#34;redirect-to-https\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;DefaultTTL\&#34;: 1800,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;AllowedMethods\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Quantity\&#34;: 2,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Items\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;HEAD\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;GET\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ], 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;CachedMethods\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Quantity\&#34;: 2,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Items\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;HEAD\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;GET\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;MinTTL\&#34;: 0, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Compress\&#34;: true,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;ForwardedValues\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Headers\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Quantity\&#34;: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Cookies\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Forward\&#34;: \&#34;none\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;QueryString\&#34;: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;TrustedSigners\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Enabled\&#34;: false, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Quantity\&#34;: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;ViewerCertificate\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;SSLSupportMethod\&#34;: \&#34;sni-only\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;ACMCertificateArn\&#34;: \&#34;</span>$SSL_ARN<span style=color:#e6db74>\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;MinimumProtocolVersion\&#34;: \&#34;TLSv1\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Certificate\&#34;: \&#34;</span>$SSL_ARN<span style=color:#e6db74>\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;CertificateSource\&#34;: \&#34;acm\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;CustomErrorResponses\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Quantity\&#34;: 2,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Items\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ErrorCode\&#34;: 403, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ResponsePagePath\&#34;: \&#34;/404.html\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ResponseCode\&#34;: \&#34;404\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ErrorCachingMinTTL\&#34;: 300
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ErrorCode\&#34;: 404, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ResponsePagePath\&#34;: \&#34;/404.html\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ResponseCode\&#34;: \&#34;404\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ErrorCachingMinTTL\&#34;: 300
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Aliases\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Quantity\&#34;: 2,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        \&#34;Items\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;</span>$YOUR_DOMAIN<span style=color:#e6db74>\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;www.</span>$YOUR_DOMAIN<span style=color:#e6db74>\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#34;</span> &gt; distroConfig.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now apply it</span>
</span></span><span style=display:flex><span>aws cloudfront create-distribution --distribution-config file://distroConfig.json
</span></span></code></pre></div><p>Nice. You&rsquo;ve got a CloudFront distribution. Run the below to get the domain name for use next.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudfront list-distributions --query <span style=color:#e6db74>&#39;DistributionList.Items[].{id:Id,comment:Comment,domain:DomainName}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># i.e. d8ukw3iojeij2.cloudfront.net</span>
</span></span></code></pre></div><h2 id=route-53-domain-setup>Route 53 Domain Setup</h2><p>Only one more step! We&rsquo;ll point your <a href=https://aws.amazon.com/route53/>Route 53</a> hosted domain to the CF distribution. This uses <a href=https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html>an alias</a> for the zone apex and a CNAME for the subdomain.</p><p>Find your current hosted zone (domain). i.e. <code>/hostedzone/ZAAWZQV036URT</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 list-hosted-zones
</span></span></code></pre></div><p>This config alias the domain to your Cloudfront distribution.</p><ul><li>The bare domain get&rsquo;s aliased</li><li>The <code>www</code> subdomain uses a CNAME</li><li>Aliases all refernce zone <code>ZAAWZQV036URT</code>, because <a href=https://docs.aws.amazon.com/Route53/latest/APIReference/CreateAliasRRSAPI.html>AWS says so</a></li><li><code>UPSERT</code> so that this config is applied idempotently</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Changes&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;UPSERT&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;ResourceRecordSet&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;AliasTarget&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;HostedZoneId&#34;</span>: <span style=color:#e6db74>&#34;Z2FDTNDATAQYW2&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;EvaluateTargetHealth&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;DNSName&#34;</span>: <span style=color:#e6db74>&#34;d8ukw3iojeij2.cloudfront.net.&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;A&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;yoursite.com.&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;UPSERT&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;ResourceRecordSet&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;ResourceRecords&#34;</span>: [
</span></span><span style=display:flex><span>          {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Value&#34;</span>: <span style=color:#e6db74>&#34;d8ukw3iojeij2.cloudfront.net&#34;</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;CNAME&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;www.yoursite.com.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;TTL&#34;</span>: <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Ok, here goes. Build the json and submit it. Note, you&rsquo;ll need to wait ~TTL seconds for the DNS to propagate.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>HOSTED_ZONE_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/hostedzone/ZAAWZQV036URT&#34;</span>
</span></span><span style=display:flex><span>DISTRO_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d8ukw3iojeij2.cloudfront.net&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Comment\&#34;: \&#34;Let there be Hugo!\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    \&#34;Changes\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Action\&#34;:\&#34;UPSERT\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;ResourceRecordSet\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;AliasTarget\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;HostedZoneId\&#34;: \&#34;Z2FDTNDATAQYW2\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;EvaluateTargetHealth\&#34;: false, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    \&#34;DNSName\&#34;: \&#34;</span>$DISTRO_URL<span style=color:#e6db74>.\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Type\&#34;: \&#34;A\&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Name\&#34;: \&#34;</span>$YOUR_DOMAIN<span style=color:#e6db74>.\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        },{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;Action\&#34;:\&#34;UPSERT\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            \&#34;ResourceRecordSet\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;ResourceRecords\&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        \&#34;Value\&#34;: \&#34;</span>$DISTRO_URL<span style=color:#e6db74>\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Type\&#34;: \&#34;CNAME\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;Name\&#34;: \&#34;www.</span>$YOUR_DOMAIN<span style=color:#e6db74>.\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                \&#34;TTL\&#34;: 300
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#34;</span> &gt; r53Batch.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HOSTED_ZONE_ID --change-batch file://r53Batch.json
</span></span></code></pre></div><h2 id=deployment>Deployment</h2><p>Great job, you&rsquo;re an AWS API zen master now! That was <em>easy</em>, right? At least it will be easy to redo later or script with Ansible.</p><p>Note, because there are 54 edge nodes worldwide, it may <strong>take some time</strong> (i.e. 30min) for your distribtion to be complete. Go get a cup of coffee and let the interwebs stabalize.</p><p>See the next post to <a href=https://lust.dev/2016/02/28/deploy-hugo-files-to-s3/>Deploy Hugo Files to S3</a>.</p></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=lust.dev href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2009 - 2022 / Powered by <a href=http://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/twistedpair/ghostwriter>Lustwriter theme</a> By J. Lust</span>
<span>/ Forked from <a href=https://github.com/jbub/ghostwriter>Ghostwriter</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script>
<script src=https://lust.dev/js/jquery.fitvids.js></script>
<script src=https://lust.dev/js/scripts.js></script></body></html>