<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>AWS Hugo Hosting, HowTo &#183; </title><meta name=description content="Easily Host your Hugo static website on CloudFront with AWS CLI"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.140.2"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="AWS Hugo Hosting, HowTo"><meta property="og:description" content="Easily Host your Hugo static website on CloudFront with AWS CLI"><meta property="og:type" content="article"><meta property="og:url" content="https://lust.dev/2016/02/27/hosting-hugo-on-aws/"><link rel=stylesheet href=https://lust.dev/dist/site.css><link rel=stylesheet href=https://lust.dev/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script async src="https://www.googletagmanager.com/gtag/js?id=G-W625CVG5Q9"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W625CVG5Q9")}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Twitter aria-label=Twitter href=https://twitter.com/lustcoder rel=me><i class="fa fa-twitter" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/twistedpair rel=me><i class="fa fa-github-alt" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint="Stack Overflow" aria-label="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust rel=me><i class="fa fa-stack-overflow" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://linkedin.com/in/josephlust rel=me><i class="fa fa-linkedin" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=../../../../>Blog</a></li><li class=site-nav-item><a href=../../../../tags>Tags</a></li><li class=site-nav-item><a href=../../../../about>About J. Lust</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">AWS Hugo Hosting, HowTo</h1><p class=post-date><span>Published <time datetime=2016-02-27 itemprop=datePublished>27 Feb '16</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=# itemprop=url rel=author>Joseph Lust</a></span></span></p><p class="post-reading post-line"><span>⏰ 7 min read</span></p></header><div class="post-content clearfix" itemprop=articleBody><p>Running your <a href=https://gohugo.io/>Hugo</a> static blog site is easy and cheap, but there are a few snags I had to solve when I deployed mine. Follow these instruction to host your Hugo blog on AWS <a href=https://aws.amazon.com/s3/>S3</a> and <a href=https://aws.amazon.com/cloudfront/>Cloudfront</a>.</p><h2 id=disclaimer>Disclaimer</h2><p>The following works for me. If you&rsquo;re not comfortable with a CLI, use the <a href=console.aws.amazon.com/console/home>AWS Web Console</a>.</p><h2 id=bucket-configuration>Bucket Configuration</h2><p>Other tutorials use the AWS web console, and feature lots of screenshots, but your&rsquo;re a savvy Hugo user. We&rsquo;ll use the AWS Commandline interface tool, ak.k. <strong>awscli</strong>. You can install it with <code>pip</code>, if you don&rsquo;t already have it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pip install awscli
</span></span><span class=line><span class=cl>aws configure <span class=c1># Follow instructions to setup</span>
</span></span></code></pre></div><p>Make a bucket. The name does not matter. No one will see this. If someone is already using that name, you&rsquo;ll need to pick another. We&rsquo;ll also add a bucket to hold all of our <strong>logs</strong>, so that you can know who visited.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Set your domain here</span>
</span></span><span class=line><span class=cl><span class=nv>YOUR_DOMAIN</span><span class=o>=</span><span class=s2>&#34;yourdomain.com&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>REGION</span><span class=o>=</span><span class=s2>&#34;us-east-1&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Don&#39;t change these</span>
</span></span><span class=line><span class=cl><span class=nv>BUCKET_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>YOUR_DOMAIN</span><span class=si>}</span><span class=s2>-cdn&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_BUCKET_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET_NAME</span><span class=si>}</span><span class=s2>-logs&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># One fresh bucket please!</span>
</span></span><span class=line><span class=cl>aws s3 mb s3://<span class=nv>$BUCKET_NAME</span> --region <span class=nv>$REGION</span>
</span></span><span class=line><span class=cl><span class=c1># And another for the logs</span>
</span></span><span class=line><span class=cl>aws s3 mb s3://<span class=nv>$LOG_BUCKET_NAME</span> --region <span class=nv>$REGION</span>
</span></span></code></pre></div><h2 id=bucket-permissions-and-logging>Bucket Permissions and Logging</h2><p>Give AWS the rights to insert logs into your bucket. Then tell S3 to log your website visits to that bucket.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Let AWS write the logs to this location</span>
</span></span><span class=line><span class=cl>aws s3api put-bucket-acl --bucket <span class=nv>$LOG_BUCKET_NAME</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--grant-write <span class=s1>&#39;URI=&#34;http://acs.amazonaws.com/groups/s3/LogDelivery&#34;&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--grant-read-acp <span class=s1>&#39;URI=&#34;http://acs.amazonaws.com/groups/s3/LogDelivery&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Setup logging</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_POLICY</span><span class=o>=</span><span class=s2>&#34;{\&#34;LoggingEnabled\&#34;:{\&#34;TargetBucket\&#34;:\&#34;</span><span class=nv>$LOG_BUCKET_NAME</span><span class=s2>\&#34;,\&#34;TargetPrefix\&#34;:\&#34;</span><span class=nv>$BUCKET_NAME</span><span class=s2>\&#34;}}&#34;</span>
</span></span><span class=line><span class=cl>aws s3api put-bucket-logging --bucket <span class=nv>$BUCKET_NAME</span> --bucket-logging-status <span class=nv>$LOG_POLICY</span>
</span></span></code></pre></div><h2 id=create-s3-bucket-website>Create S3 Bucket Website</h2><p>We&rsquo;ll tell S3 to turn our bucket into a website. This will give it a public URL that does redirecting for us. We need this since Hugo blog pages like <strong>foo.com/bob/</strong> are really <strong>foo.com/bob/index.html</strong>. We need to redirect those root paths like <strong>/bob/</strong> to <strong>/bob/index.html</strong>. Normally you&rsquo;d need rewrite rules with Nginx or Apache, but S3 can do that too.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create website config</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;{
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;IndexDocument\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Suffix\&#34;: \&#34;index.html\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    },
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;ErrorDocument\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Key\&#34;: \&#34;404.html\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    },
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;RoutingRules\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>        {
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Redirect\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ReplaceKeyWith\&#34;: \&#34;index.html\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            },
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Condition\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;KeyPrefixEquals\&#34;: \&#34;/\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        }
</span></span></span><span class=line><span class=cl><span class=s2>    ]
</span></span></span><span class=line><span class=cl><span class=s2>}&#34;</span> &gt; website.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws s3api put-bucket-website --bucket <span class=nv>$BUCKET_NAME</span> --website-configuration file://website.json
</span></span></code></pre></div><p>Now you can visit <code>http://&lt;bucket_name>.s3-website-&lt;region>.amazonaws.com</code> to browse your site!</p><h2 id=get-free-ssl-certificates>Get Free SSL Certificates</h2><p>Everything should have SSL, so AWS decided to give away <a href=https://aws.amazon.com/certificate-manager/pricing/>FREE SSL certificates</a> for all AWS users. Thanks, Jeff! Make sure you can access the admin email <a href=http://www.whois-search.com/>address on your domain</a>, and then run the following and check your email. The email should go through instantly. Note that we&rsquo;re also requesting the <code>www.</code> variant of this domain. We&rsquo;ll use this for redirecting <code>www.foo.com</code> to <code>foo.com</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws acm request-certificate --domain-name <span class=nv>$YOUR_DOMAIN</span> --subject-alternative-names <span class=s2>&#34;www.</span><span class=nv>$YOUR_DOMAIN</span><span class=s2>&#34;</span> --idempotency-token <span class=s2>&#34;`date +%s`&#34;</span>
</span></span></code></pre></div><p>The idempotency token will prevent running this twice from sending two requests. Also, note that ACM will renew your certs each year automatically, so this SSL really is <a href=https://en.wikipedia.org/wiki/Ron_Popeil>set it and forget it</a>.</p><p>Call ACM and get the ARN of your cert to use in the next step.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws acm list-certificates --certificate-statuses ISSUED
</span></span><span class=line><span class=cl><span class=c1># Example result</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;CertificateSummaryList&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CertificateArn&#34;</span>: <span class=s2>&#34;arn:aws:acm:us-east-1:7865196219991:certificate/de305d54-75b4-431b-adb2-eb6b9e546014&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;DomainName&#34;</span>: <span class=s2>&#34;yoursite.com&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=cloudfront-setup>CloudFront Setup</h2><p>S3 hosts your files as a website, but we want a vanity domain and custom SSL. Plus, a <a href=https://aws.amazon.com/cloudfront/details/#Detailed_Description>worldwide 54 edge location CDN</a> would be nice. AWS CloudFront can accomplish all of this quite easily.</p><p>First we&rsquo;ll tell <code>awscli</code> to enable the CloudFront tools, which are presently in &ldquo;Preview Mode.&rdquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws  configure  <span class=nb>set</span> preview.cloudfront <span class=nb>true</span> <span class=c1># Honey badger don&#39;t care</span>
</span></span></code></pre></div><p>This is a long config, so let&rsquo;s break it down:</p><h4 id=origin-config>Origin Config</h4><p>We must use the <strong>S3 website hosting URL</strong> not simply point to the S3 bucket like regular CF setup. This allows us to get <strong>index.html</strong> redirecting. This also means we cannot use <strong>HTTPS Only</strong> on the origin, because its domain won&rsquo;t match the generic S3 certificate AWS uses for all S3 requests.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;Origins&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Id&#34;</span><span class=p>:</span> <span class=s2>&#34;$BUCKET_NAME-origin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;OriginPath&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;CustomOriginConfig&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;OriginProtocolPolicy&#34;</span><span class=p>:</span> <span class=s2>&#34;http-only&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;HTTPPort&#34;</span><span class=p>:</span> <span class=mi>80</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;OriginSslProtocols&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;TLSv1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;TLSv1.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;TLSv1.2&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;HTTPSPort&#34;</span><span class=p>:</span> <span class=mi>443</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;DomainName&#34;</span><span class=p>:</span> <span class=s2>&#34;$BUCKET_NAME.s3-website-$REGION.amazonaws.com&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><h4 id=logging-config>Logging Config</h4><ul><li>Log CF hits to the buckets we already made</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;Logging&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Bucket&#34;</span><span class=p>:</span> <span class=s2>&#34;$LOG_BUCKET_NAME.s3.amazonaws.com&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;${BUCKET_NAME}-cf/&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Enabled&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=cache-behavior-config>Cache Behavior Config</h4><ul><li>We want everyone coming to the site to use SSL, so we&rsquo;ll redirect port 80 → 443.</li><li>Cache content for 30min by DefaultCacheBehavior</li><li>Only forward <code>HEAD</code> and <code>GET</code> requests, cache them too</li><li>Gzip content if possible (reduce bandwidth usage, faster)</li><li>Don&rsquo;t forward headers</li><li>Don&rsquo;t trust other signers</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;DefaultCacheBehavior&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nt>&#34;DefaultCacheBehavior&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ViewerProtocolPolicy&#34;</span><span class=p>:</span> <span class=s2>&#34;redirect-to-https&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;DefaultTTL&#34;</span><span class=p>:</span> <span class=mi>1800</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;AllowedMethods&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;HEAD&#34;</span><span class=p>,</span><span class=s2>&#34;GET&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;CachedMethods&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;HEAD&#34;</span><span class=p>,</span><span class=s2>&#34;GET&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MinTTL&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Compress&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ForwardedValues&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Headers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cookies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Forward&#34;</span><span class=p>:</span> <span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;QueryString&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;TrustedSigners&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Enabled&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=ssl-config>SSL Config</h4><ul><li>Use the new SSL cert from ACM, referenced by the ARN</li><li>Use <a href=https://en.wikipedia.org/wiki/Server_Name_Indication>SNI</a>, breaking wood burning browsers on WinXP, because it&rsquo;s FREE</li><li>Warning: <strong>Not</strong> using SNI <a href=https://aws.amazon.com/cloudfront/pricing/#Request_Pricing_for_All_HTTP_Methods_(per_10,000)>costs <code>$600/mo</code></a>, so <strong>use SNI</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;ViewerCertificate&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;SSLSupportMethod&#34;</span><span class=p>:</span> <span class=s2>&#34;sni-only&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ACMCertificateArn&#34;</span><span class=p>:</span> <span class=s2>&#34;$SSL_ARN&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MinimumProtocolVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;TLSv1&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Certificate&#34;</span><span class=p>:</span> <span class=s2>&#34;$SSL_ARN&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CertificateSource&#34;</span><span class=p>:</span> <span class=s2>&#34;acm&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=error-config>Error Config</h4><ul><li>Forward Cloudfront <code>Not Found</code> and <code>Forbidden</code> errors to your custom pages</li><li>Cache failures for 5min, then try the Origin again</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;CustomErrorResponses&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ErrorCode&#34;</span><span class=p>:</span> <span class=mi>403</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ResponsePagePath&#34;</span><span class=p>:</span> <span class=s2>&#34;/404.html&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ResponseCode&#34;</span><span class=p>:</span> <span class=s2>&#34;404&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ErrorCachingMinTTL&#34;</span><span class=p>:</span> <span class=mi>300</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ErrorCode&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ResponsePagePath&#34;</span><span class=p>:</span> <span class=s2>&#34;/404.html&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ResponseCode&#34;</span><span class=p>:</span> <span class=s2>&#34;404&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ErrorCachingMinTTL&#34;</span><span class=p>:</span> <span class=mi>300</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=redirect-config>Redirect Config</h4><ul><li>Mask the ugly default CF domain with your vanity domain</li><li>Accept root and <code>www.</code> variants</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;Aliases&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;$YOUR_DOMAIN&#34;</span><span class=p>,</span> <span class=s2>&#34;www.$YOUR_DOMAIN&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=misc-config>Misc Config</h4><ul><li>Serve <code>foo.com/index.html</code> to <code>foo.com</code> requests</li><li>Use all edge nodes worldwide</li><li>Turn it on</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;DefaultRootObject&#34;</span><span class=p>:</span> <span class=s2>&#34;index.html&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;PriceClass&#34;</span><span class=p>:</span> <span class=s2>&#34;PriceClass_All&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Enabled&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=making-the-distribution>Making the Distribution</h3><p>Sorry, it&rsquo;s really ugly, but such is bash escaping.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># From above</span>
</span></span><span class=line><span class=cl><span class=nv>SSL_ARN</span><span class=o>=</span><span class=s2>&#34;arn:aws:acm:us-east-1:7865196219991:certificate/de305d54-75b4-431b-adb2-eb6b9e546014&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>CALLER_REF</span><span class=o>=</span><span class=s2>&#34;`date +%s`&#34;</span> <span class=c1># current second</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;{
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Comment\&#34;: \&#34;</span><span class=nv>$BUCKET_NAME</span><span class=s2> Static Hosting\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Logging\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Bucket\&#34;: \&#34;</span><span class=nv>$LOG_BUCKET_NAME</span><span class=s2>.s3.amazonaws.com\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Prefix\&#34;: \&#34;</span><span class=si>${</span><span class=nv>BUCKET_NAME</span><span class=si>}</span><span class=s2>-cf/\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Enabled\&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;IncludeCookies\&#34;: false
</span></span></span><span class=line><span class=cl><span class=s2>    }, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Origins\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Quantity\&#34;: 1,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Items\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>            {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Id\&#34;:\&#34;</span><span class=nv>$BUCKET_NAME</span><span class=s2>-origin\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;OriginPath\&#34;: \&#34;\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;CustomOriginConfig\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;OriginProtocolPolicy\&#34;: \&#34;http-only\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;HTTPPort\&#34;: 80, 
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;OriginSslProtocols\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                        \&#34;Quantity\&#34;: 3,
</span></span></span><span class=line><span class=cl><span class=s2>                        \&#34;Items\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>                            \&#34;TLSv1\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                            \&#34;TLSv1.1\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                            \&#34;TLSv1.2\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                        ]
</span></span></span><span class=line><span class=cl><span class=s2>                    }, 
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;HTTPSPort\&#34;: 443
</span></span></span><span class=line><span class=cl><span class=s2>                }, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;DomainName\&#34;: \&#34;</span><span class=nv>$BUCKET_NAME</span><span class=s2>.s3-website-</span><span class=nv>$REGION</span><span class=s2>.amazonaws.com\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        ]
</span></span></span><span class=line><span class=cl><span class=s2>    }, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;DefaultRootObject\&#34;: \&#34;index.html\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;PriceClass\&#34;: \&#34;PriceClass_All\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Enabled\&#34;: true, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;CallerReference\&#34;: \&#34;</span><span class=nv>$CALLER_REF</span><span class=s2>\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;DefaultCacheBehavior\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;TargetOriginId\&#34;: \&#34;</span><span class=nv>$BUCKET_NAME</span><span class=s2>-origin\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;ViewerProtocolPolicy\&#34;: \&#34;redirect-to-https\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;DefaultTTL\&#34;: 1800,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;AllowedMethods\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Quantity\&#34;: 2,
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Items\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;HEAD\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;GET\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            ], 
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;CachedMethods\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Quantity\&#34;: 2,
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Items\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;HEAD\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;GET\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                ]
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        }, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;MinTTL\&#34;: 0, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Compress\&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;ForwardedValues\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Headers\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Quantity\&#34;: 0
</span></span></span><span class=line><span class=cl><span class=s2>            }, 
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Cookies\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Forward\&#34;: \&#34;none\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            }, 
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;QueryString\&#34;: false
</span></span></span><span class=line><span class=cl><span class=s2>        },
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;TrustedSigners\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Enabled\&#34;: false, 
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Quantity\&#34;: 0
</span></span></span><span class=line><span class=cl><span class=s2>        }
</span></span></span><span class=line><span class=cl><span class=s2>    }, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;ViewerCertificate\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;SSLSupportMethod\&#34;: \&#34;sni-only\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;ACMCertificateArn\&#34;: \&#34;</span><span class=nv>$SSL_ARN</span><span class=s2>\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;MinimumProtocolVersion\&#34;: \&#34;TLSv1\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Certificate\&#34;: \&#34;</span><span class=nv>$SSL_ARN</span><span class=s2>\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;CertificateSource\&#34;: \&#34;acm\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    }, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;CustomErrorResponses\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Quantity\&#34;: 2,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Items\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>            {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ErrorCode\&#34;: 403, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ResponsePagePath\&#34;: \&#34;/404.html\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ResponseCode\&#34;: \&#34;404\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ErrorCachingMinTTL\&#34;: 300
</span></span></span><span class=line><span class=cl><span class=s2>            }, 
</span></span></span><span class=line><span class=cl><span class=s2>            {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ErrorCode\&#34;: 404, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ResponsePagePath\&#34;: \&#34;/404.html\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ResponseCode\&#34;: \&#34;404\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ErrorCachingMinTTL\&#34;: 300
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        ]
</span></span></span><span class=line><span class=cl><span class=s2>    }, 
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Aliases\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Quantity\&#34;: 2,
</span></span></span><span class=line><span class=cl><span class=s2>        \&#34;Items\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;</span><span class=nv>$YOUR_DOMAIN</span><span class=s2>\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;www.</span><span class=nv>$YOUR_DOMAIN</span><span class=s2>\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ]
</span></span></span><span class=line><span class=cl><span class=s2>    }
</span></span></span><span class=line><span class=cl><span class=s2>}&#34;</span> &gt; distroConfig.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Now apply it</span>
</span></span><span class=line><span class=cl>aws cloudfront create-distribution --distribution-config file://distroConfig.json
</span></span></code></pre></div><p>Nice. You&rsquo;ve got a CloudFront distribution. Run the below to get the domain name for use next.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws cloudfront list-distributions --query <span class=s1>&#39;DistributionList.Items[].{id:Id,comment:Comment,domain:DomainName}&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># i.e. d8ukw3iojeij2.cloudfront.net</span>
</span></span></code></pre></div><h2 id=route-53-domain-setup>Route 53 Domain Setup</h2><p>Only one more step! We&rsquo;ll point your <a href=https://aws.amazon.com/route53/>Route 53</a> hosted domain to the CF distribution. This uses <a href=https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html>an alias</a> for the zone apex and a CNAME for the subdomain.</p><p>Find your current hosted zone (domain). i.e. <code>/hostedzone/ZAAWZQV036URT</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws route53 list-hosted-zones
</span></span></code></pre></div><p>This config alias the domain to your Cloudfront distribution.</p><ul><li>The bare domain get&rsquo;s aliased</li><li>The <code>www</code> subdomain uses a CNAME</li><li>Aliases all refernce zone <code>ZAAWZQV036URT</code>, because <a href=https://docs.aws.amazon.com/Route53/latest/APIReference/CreateAliasRRSAPI.html>AWS says so</a></li><li><code>UPSERT</code> so that this config is applied idempotently</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Changes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;UPSERT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;ResourceRecordSet&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;AliasTarget&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;HostedZoneId&#34;</span><span class=p>:</span> <span class=s2>&#34;Z2FDTNDATAQYW2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;EvaluateTargetHealth&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;DNSName&#34;</span><span class=p>:</span> <span class=s2>&#34;d8ukw3iojeij2.cloudfront.net.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;yoursite.com.&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;UPSERT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;ResourceRecordSet&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;ResourceRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Value&#34;</span><span class=p>:</span> <span class=s2>&#34;d8ukw3iojeij2.cloudfront.net&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;CNAME&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;www.yoursite.com.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;TTL&#34;</span><span class=p>:</span> <span class=mi>300</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Ok, here goes. Build the json and submit it. Note, you&rsquo;ll need to wait ~TTL seconds for the DNS to propagate.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>HOSTED_ZONE_ID</span><span class=o>=</span><span class=s2>&#34;/hostedzone/ZAAWZQV036URT&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRO_URL</span><span class=o>=</span><span class=s2>&#34;d8ukw3iojeij2.cloudfront.net&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;{
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Comment\&#34;: \&#34;Let there be Hugo!\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>    \&#34;Changes\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>        {
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Action\&#34;:\&#34;UPSERT\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;ResourceRecordSet\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;AliasTarget\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;HostedZoneId\&#34;: \&#34;Z2FDTNDATAQYW2\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;EvaluateTargetHealth\&#34;: false, 
</span></span></span><span class=line><span class=cl><span class=s2>                    \&#34;DNSName\&#34;: \&#34;</span><span class=nv>$DISTRO_URL</span><span class=s2>.\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                }, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Type\&#34;: \&#34;A\&#34;, 
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Name\&#34;: \&#34;</span><span class=nv>$YOUR_DOMAIN</span><span class=s2>.\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        },{
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;Action\&#34;:\&#34;UPSERT\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>            \&#34;ResourceRecordSet\&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;ResourceRecords\&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>                    {
</span></span></span><span class=line><span class=cl><span class=s2>                        \&#34;Value\&#34;: \&#34;</span><span class=nv>$DISTRO_URL</span><span class=s2>\&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                    }
</span></span></span><span class=line><span class=cl><span class=s2>                ],
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Type\&#34;: \&#34;CNAME\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;Name\&#34;: \&#34;www.</span><span class=nv>$YOUR_DOMAIN</span><span class=s2>.\&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                \&#34;TTL\&#34;: 300
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        }
</span></span></span><span class=line><span class=cl><span class=s2>    ]
</span></span></span><span class=line><span class=cl><span class=s2>}&#34;</span> &gt; r53Batch.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws route53 change-resource-record-sets --hosted-zone-id <span class=nv>$HOSTED_ZONE_ID</span> --change-batch file://r53Batch.json
</span></span></code></pre></div><h2 id=deployment>Deployment</h2><p>Great job, you&rsquo;re an AWS API zen master now! That was <em>easy</em>, right? At least it will be easy to redo later or script with Ansible.</p><p>Note, because there are 54 edge nodes worldwide, it may <strong>take some time</strong> (i.e. 30min) for your distribtion to be complete. Go get a cup of coffee and let the interwebs stabalize.</p><p>See the next post to <a href=https://lust.dev/2016/02/28/deploy-hugo-files-to-s3/>Deploy Hugo Files to S3</a>.</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=../../../../tags/go/>Go</a>,
<a href=../../../../tags/cloudfront/>CloudFront</a>,
<a href=../../../../tags/aws/>AWS</a>,
<a href=../../../../tags/hugo/>Hugo</a>,
<a href=../../../../tags/s3/>S3</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=AWS%20Hugo%20Hosting%2c%20HowTo&url=https%3a%2f%2flust.dev%2f2016%2f02%2f27%2fhosting-hugo-on-aws%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' aria-label="Share on Twitter"><i class="fa fa-twitter" aria-hidden=true></i>
</a><a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flust.dev%2f2016%2f02%2f27%2fhosting-hugo-on-aws%2f" onclick='return window.open(this.href,"facebook-share","width=580,height=296"),!1' aria-label="Share on Facebook"><i class="fa fa-facebook" aria-hidden=true></i></a></div></footer><div class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//lustforge.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2024 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script><script src=https://lust.dev/js/jquery.fitvids.js></script><script src=https://lust.dev/js/scripts.js></script></body></html>