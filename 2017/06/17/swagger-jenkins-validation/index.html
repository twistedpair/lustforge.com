<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Swagger Jenkins Validation &#183; </title><meta name=description content="Validate complex Swagger files with Jenkins automatically"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.140.2"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Swagger Jenkins Validation"><meta property="og:description" content="Validate complex Swagger files with Jenkins automatically"><meta property="og:type" content="article"><meta property="og:url" content="https://lust.dev/2017/06/17/swagger-jenkins-validation/"><link rel=stylesheet href=https://lust.dev/dist/site.css><link rel=stylesheet href=https://lust.dev/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://lust.dev//css/font-awesome-all.min.css></head><body><script async src="https://www.googletagmanager.com/gtag/js?id=G-W625CVG5Q9"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W625CVG5Q9")}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Bluesky aria-label=bluesky href=https://bsky.app/profile/lust.dev rel=me><i class="fa-brands fa-bluesky" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/twistedpair rel=me><i class="fa-brands fa-github-alt" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint="Stack Overflow" aria-label="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust rel=me><i class="fa-brands fa-stack-overflow" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://linkedin.com/in/josephlust rel=me><i class="fa-brands fa-linkedin" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=../../../../>Blog</a></li><li class=site-nav-item><a href=../../../../tags>Tags</a></li><li class=site-nav-item><a href=../../../../about>About J. Lust</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Swagger Jenkins Validation</h1><p class=post-date><span>Published <time datetime=2017-06-17 itemprop=datePublished>17 Jun '17</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=# itemprop=url rel=author>Joseph Lust</a></span></span></p><p class="post-reading post-line"><span>‚è∞ 3 min read</span></p></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=../../../../img/swagger_jenkins_post_image.png><h1 id=the-mega-spec-problem>The Mega Spec Problem</h1><p><a href=https://swagger.io/specification/>Swagger Spec</a> is a great way to define and document API projects. Your code and documentation live and ship together, allowing for rapid documentation and development. However, you might say it&rsquo;s too good.</p><p>When a team embraces Swagger, documenting every endpoint in great detail, the Swagger files swell to untenable dimensions<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. What worked for the <a href=http://petstore.swagger.io/>PetStore Spec</a> no longer runs against the <a href=http://editor.swagger.io/>Swagger Editor webapp</a><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, so developers don&rsquo;t bother to validate their spec edits before checkin. CI/CD auto updates your Swagger docs on deploy, auto breaking the documentation developers and customers rely upon, ultimately impeding productivity.</p><p>Thus, an automatic quality gate on Swagger Specs can mitigate this path to rapid documentation corruption.</p><h1 id=automating-swagger-spec-validation>Automating Swagger Spec Validation</h1><p>You can catch two types of spec defects:</p><ol><li>Format errors (e.g. JSON or YAML defects)</li><li>Invalid spec definitions</li></ol><p>Something as simple as running JSON through <a href=https://stedolan.github.io/jq/>jq</a> will catch format errors, but we&rsquo;ll focus on #2, since it&rsquo;s a catch all.</p><p>Yelp&rsquo;s <a href=https://github.com/Yelp/swagger_spec_validator>Swagger Spec Validator</a> is just the ticket<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>set</span> -e
</span></span><span class=line><span class=cl><span class=nv>FULL_SPEC_PATH</span><span class=o>=</span><span class=s2>&#34;/path/to/spec.json&#34;</span> <span class=c1># Absolute, please</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Idempotent, local library install</span>
</span></span><span class=line><span class=cl>virtualenv .
</span></span><span class=line><span class=cl><span class=nb>source</span> bin/activate
</span></span><span class=line><span class=cl>pip install swagger-spec-validator
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Test the Spec</span>
</span></span><span class=line><span class=cl>python -c <span class=s2>&#34;from swagger_spec_validator import validate_spec_url; validate_spec_url(&#39;file://</span><span class=si>${</span><span class=nv>FULL_SPEC_PATH</span><span class=si>}</span><span class=s2>&#39;)&#34;</span>
</span></span></code></pre></div><p>Expect no output on success, or a trace on error.</p><p>For example, let&rsquo;s corrupt the <a href=http://petstore.swagger.io/v2/swagger.json>Pet spec file</a>, but keep it in valid JSON format.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;ApiResponse_WRONG_NAME&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>...</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Validation outputs the following helpful message, noting the <code>ApiResponse</code> entity references are no longer valid.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Traceback <span class=o>(</span>most recent call last<span class=o>)</span>:
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;&lt;string&gt;&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/usr/local/lib/python2.7/dist-packages/jsonschema/validators.py&#34;</span>, line 387, in resolve_from_url
</span></span><span class=line><span class=cl>    <span class=k>return</span> self.resolve_fragment<span class=o>(</span>document, fragment<span class=o>)</span>
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/usr/local/lib/python2.7/dist-packages/jsonschema/validators.py&#34;</span>, line 421, in resolve_fragment
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Unresolvable JSON pointer: %r&#34;</span> % fragment
</span></span><span class=line><span class=cl>swagger_spec_validator.common.SwaggerValidationError: Unresolvable JSON pointer: u<span class=s1>&#39;definitions/ApiResponse&#39;</span>
</span></span></code></pre></div><h1 id=jenkins-wireup>Jenkins Wireup</h1><p>Validation is great, but it will only reliably occur when fully automatic (developers are busy people!). Integration with Jenkins will ensure every Swagger Spec commit is valid, and prevent bad specs from getting into master.</p><p>Simply add an <code>Execute Shell</code> step and pass the above example (<a href=https://gist.github.com/twistedpair/bc743b7e1a4b41753de6b148280410da>gist link</a>). The non-zero exit code on error will trigger an informative message to the offending developer.</p><p><em>Note:</em> I prefer to have this as the first build step to &ldquo;fail fast&rdquo; on checkin, especially for long build processes, but you may prefer to do it last, so all build errors are reported.</p><p>Example Jenkins Config Screen:</p><figure><img src=../../../../img/swagger_validator_jenkins_config.png></figure><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>I had to wrangle an 11K spec file. Use <a href=http://azimi.me/2015/07/16/split-swagger-into-smaller-files.html>$ref includes</a> if possible.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Running Swagger Editor locally is slow (e.g. 6min npm install/start), consider the <a href=http://halyph.com/talks/2016-swagger-slides/Run%20Swagger%20Editor%20Locally.html>prebuilt Docker image</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Aside from the &ldquo;read the docs&rdquo; link to the <a href=https://swagger-spec-validator.readthedocs.io/en/latest/>empty docs site</a>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=../../../../tags/swagger/>swagger</a>,
<a href=../../../../tags/python/>python</a>,
<a href=../../../../tags/ci/>ci</a>,
<a href=../../../../tags/jenkins/>jenkins</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Swagger%20Jenkins%20Validation&url=https%3a%2f%2flust.dev%2f2017%2f06%2f17%2fswagger-jenkins-validation%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' aria-label="Share on Twitter"><i class="fa fa-twitter" aria-hidden=true></i>
</a><a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flust.dev%2f2017%2f06%2f17%2fswagger-jenkins-validation%2f" onclick='return window.open(this.href,"facebook-share","width=580,height=296"),!1' aria-label="Share on Facebook"><i class="fa fa-facebook" aria-hidden=true></i></a></div></footer><div class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//lustforge.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2024 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script><script src=https://lust.dev/js/jquery.fitvids.js></script><script src=https://lust.dev/js/scripts.js></script></body></html>