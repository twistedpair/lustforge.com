<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Iam on lust.dev</title>
    <link>https://lust.dev/tags/iam/</link>
    <description>Recent content in Iam on lust.dev</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Joseph Lust</copyright>
    <lastBuildDate>Fri, 08 Jul 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://lust.dev/tags/iam/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>AWS Command Line Password Reset</title>
      <link>https://lust.dev/2016/07/08/aws-cli-password-reset/</link>
      <pubDate>Fri, 08 Jul 2016 00:00:00 +0000</pubDate>
      
      <guid>https://lust.dev/2016/07/08/aws-cli-password-reset/</guid>
      <description>

&lt;h1 id=&#34;oh-nuts:5efceb1a28e3916f5b9c11396608079c&#34;&gt;Oh, Nuts&lt;/h1&gt;

&lt;p&gt;Your AWS console login just expired, as the login prompt &lt;em&gt;has been warning for weeks&lt;/em&gt;. You need to update that Route 53 entry and your boss is waiting. Do you call the sysadmin and beg for a reset, or can you solve this yourself?&lt;/p&gt;

&lt;h1 id=&#34;aws-cli-to-the-rescue:5efceb1a28e3916f5b9c11396608079c&#34;&gt;AWS CLI To the Rescue&lt;/h1&gt;

&lt;p&gt;No worries, you&amp;rsquo;ve got this covered in 15 seconds.&lt;/p&gt;

&lt;p&gt;Use the iam API call &lt;a href=&#34;https://docs.aws.amazon.com/cli/latest/reference/iam/update-login-profile.html&#34;&gt;update-login-profile&lt;/a&gt;&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:5efceb1a28e3916f5b9c11396608079c:2&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:5efceb1a28e3916f5b9c11396608079c:2&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; combined with your aws iam username (login name for the &lt;a href=&#34;https://console.aws.amazon.com/&#34;&gt;AWS Console Login&lt;/a&gt;).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;aws iam update-login-profile --user-name jsmith --password sesame --password-reset-required
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The combination is cracked. Login. Whistle innocently like this never happened.&lt;/p&gt;

&lt;h1 id=&#34;other-dead-ends:5efceb1a28e3916f5b9c11396608079c&#34;&gt;Other Dead Ends&lt;/h1&gt;

&lt;p&gt;The awscli has another tempting, but misleading API called &lt;a href=&#34;https://docs.aws.amazon.com/cli/latest/reference/iam/change-password.html&#34;&gt;change-password&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If you tried it, you&amp;rsquo;d be saddened to see the required &lt;code&gt;--old-password&lt;/code&gt; parameter. This is a red herring. Dodge left.&lt;/p&gt;

&lt;h1 id=&#34;you-don-t-have-aws-cli-password-reset-access:5efceb1a28e3916f5b9c11396608079c&#34;&gt;You Don&amp;rsquo;t Have AWS CLI Password Reset Access&lt;/h1&gt;

&lt;p&gt;We got a problem here. Your choices are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Kowtow to your sysadmin for mercy&lt;/li&gt;
&lt;li&gt;If it&amp;rsquo;s a root account, use the &lt;a href=&#34;https://www.amazon.com/ap/forgotpassword?openid.pape.preferred_auth_policies=MultifactorPhysical&amp;amp;openid.pape.max_auth_age=0&amp;amp;openid.return_to=https%3A%2F%2Fsignin.aws.amazon.com%2Foauth%3Fresponse_type%3Dcode%26client_id%3Darn%253Aaws%253Aiam%253A%253A015428540659%253Auser%252Fhomepage%26redirect_uri%3Dhttps%253A%252F%252Fconsole.aws.amazon.com%252Fconsole%252Fhome%253Fstate%253DhashArgs%252523%2526isauthcode%253Dtrue%26noAuthCookie%3Dtrue&amp;amp;prevRID=14XBRCDW9RJD7GXZ9KTP&amp;amp;openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&amp;amp;openid.assoc_handle=aws&amp;amp;openid.mode=checkid_setup&amp;amp;openid.ns.pape=http%3A%2F%2Fspecs.openid.net%2Fextensions%2Fpape%2F1.0&amp;amp;openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&amp;amp;pageId=aws.ssop&amp;amp;openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&#34;&gt;password reset process&lt;/a&gt; to get a reset email&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:5efceb1a28e3916f5b9c11396608079c:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:5efceb1a28e3916f5b9c11396608079c:1&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;allow-users-to-reset-passwords:5efceb1a28e3916f5b9c11396608079c&#34;&gt;Allow Users to Reset Passwords&lt;/h1&gt;

&lt;p&gt;If you&amp;rsquo;re a sysadmin, set the following IAM policy to enable self service user password reset.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
    &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
    &amp;quot;Statement&amp;quot;: [
        {
            &amp;quot;Sid&amp;quot;: &amp;quot;Stmt1500731194000&amp;quot;,
            &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
            &amp;quot;Action&amp;quot;: [
                &amp;quot;iam:UpdateLoginProfile&amp;quot;
            ],
            &amp;quot;Resource&amp;quot;: [
                &amp;quot;arn:aws:iam::1234567890:user/favorite_user&amp;quot;
            ]
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:5efceb1a28e3916f5b9c11396608079c:2&#34;&gt;Password reset requires &lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateLoginProfile.html&#34;&gt;UpdateLoginProfile&lt;/a&gt; IAM policy action, included in Admin role.
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:5efceb1a28e3916f5b9c11396608079c:2&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:5efceb1a28e3916f5b9c11396608079c:1&#34;&gt;This email will be sent to the root account email only. You&amp;rsquo;ve got access, right?
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:5efceb1a28e3916f5b9c11396608079c:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Login With Broken AWS MFA Device</title>
      <link>https://lust.dev/2016/06/14/login-broken-aws-mfa-device/</link>
      <pubDate>Tue, 14 Jun 2016 00:00:00 +0000</pubDate>
      
      <guid>https://lust.dev/2016/06/14/login-broken-aws-mfa-device/</guid>
      <description>

&lt;h1 id=&#34;oh-fudge:0f9727b081e90b0e13d3a31272a59d66&#34;&gt;Oh, Fudge&lt;/h1&gt;

&lt;p&gt;Your dog just broken your iPhone&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:0f9727b081e90b0e13d3a31272a59d66:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:0f9727b081e90b0e13d3a31272a59d66:1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; and the master token for your AWS root account is locked up in the safe at work. Your boss needs an emergency update to your prod infrastructure. How do you login to your MFA protected AWS account?&lt;/p&gt;

&lt;h1 id=&#34;aws-cli-to-the-rescue:0f9727b081e90b0e13d3a31272a59d66&#34;&gt;AWS CLI To the Rescue&lt;/h1&gt;

&lt;p&gt;No worries, you&amp;rsquo;ve got this covered in 15 seconds.&lt;/p&gt;

&lt;p&gt;Lookup the ARN of your MFA device in IAM, via the username you use for &lt;a href=&#34;https://console.aws.amazon.com/&#34;&gt;AWS Console Login&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;aws iam list-mfa-devices --user-name john_smith
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Outputs:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
    &amp;quot;MFADevices&amp;quot;: [
        {
            &amp;quot;UserName&amp;quot;: &amp;quot;john_smith&amp;quot;,
            &amp;quot;SerialNumber&amp;quot;: &amp;quot;arn:aws:iam::1234567890123:mfa/john_smith&amp;quot;,
            &amp;quot;EnableDate&amp;quot;: &amp;quot;2016-01-01T17:00:00Z&amp;quot;
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;aws iam deactivate-mfa-device --user-name john_smith --serial-number arn:aws:iam::1234567890123:mfa/john_smith
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The safe is cracked. Login. Pretend like this never happened.&lt;/p&gt;

&lt;h1 id=&#34;you-don-t-have-aws-cli-admin-access:0f9727b081e90b0e13d3a31272a59d66&#34;&gt;You Don&amp;rsquo;t Have AWS CLI Admin Access&lt;/h1&gt;

&lt;p&gt;We got a problem here. Your choices are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Use your root token / ask your sys admin to remove the MFA from your account&lt;/li&gt;
&lt;li&gt;Contact &lt;a href=&#34;https://aws.amazon.com/forms/aws-mfa-support&#34;&gt;AWS MFA Device Support&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:0f9727b081e90b0e13d3a31272a59d66:1&#34;&gt;Consider ordering a &lt;a href=&#34;https://www.amazon.com/SafeNet-IDProve-Time-based-6-Digit-Services/dp/B002CRN5X8?ie=UTF8&amp;amp;keywords=gemalto%20aws&amp;amp;qid=1462806259&amp;amp;ref_=sr_1_1&amp;amp;sr=8-1&#34;&gt;physical token&lt;/a&gt;, inserting in mason jar, and burying in backyard
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:0f9727b081e90b0e13d3a31272a59d66:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>