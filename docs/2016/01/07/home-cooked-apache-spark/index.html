<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Home Cooked Apache Spark &middot; Joseph Lust</title>
        <meta name="description" content="what Lust hath wrought">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.16-DEV" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="https://lust.dev/favicon.png">
        <link rel="stylesheet" href="https://lust.dev/css/normalize.css">
	<link rel="stylesheet" href="https://lust.dev/css/highlight/obsidian.css">
        <link rel="stylesheet" href="https://lust.dev/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        
        

            
            <meta property="og:type"   content="article" />
            <meta property="og:url"    content="https://lust.dev/2016/01/07/home-cooked-apache-spark/" />
            <meta property="og:title"  content="Home Cooked Apache Spark" />

            <meta name="twitter:domain" value="lustforge.com" />
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:title" value="Home Cooked Apache Spark" />
            

            
            <meta name="twitter:url" value="https://lust.dev/2016/01/07/home-cooked-apache-spark/"/>

            
        
        
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17498476-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="lust.dev" href="https://lust.dev/">lust.dev</a>
                            </h1>
                        
			
                        	<a class="button-square" href="https://lust.dev/index.xml"><i title="RSS Feed" class="fa fa-rss"></i></a>
			
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/lustcoder">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/twistedpair">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href="https://stackoverflow.com/users/564157/joseph-lust">
                                <i class="fa fa-stack-overflow"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://www.linkedin.com/in/josephlust">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
			
			<h1 class="site-title" style="margin-left:10px;">
                            <a class="site-title" data-hint="Lust" title="Meet the groundskeeper" href="https://lust.dev/about/">J. Lust &#8250;</a>
                        </h1>
                    </div>

                    <ul class="site-nav">
                        
                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">Home Cooked Apache Spark</h1>
    
</header>

        
<div class="post-content clearfix">

        
    
    
    <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "articleSection" : "post",
        "name" : "Home Cooked Apache Spark",
        "headline" : "Home Cooked Apache Spark",
        "description" : "We use Apache Spark for various applications at my job, but Spark is still relatively unstable, as evidenced by the project\x26rsquo;s 11K\x2b pull requests. To maintain developer velocity, we regularly patch show stopper bugs in the Spark source. The process is simple. Install JDK 6, which is required for PySpark (or you\x26rsquo;ll get a lengthy warning). Use the oracle-java8-set-default package to switch between Java 6 and 8, or set JAVA_HOME. sudo apt-get install oracle-java6-installer oracle-java8-set-default # Go back to Java 8 when you\x27re done building Fork the Apache Spark repo so you can submit a Pull Request later Clone it locally, checking out your tag of interest git clone git@github.com:mc10-inc\/spark.git special-spark cd special-spark git checkout v1.4.1 # Tag of interest JAVA_HOME=\x26quot;\/usr\/lib\/jvm\/java-6-oracle\x26quot; # In case you\x27ve got 7\/8\/9 installed .\/make-distribution.sh --name al-dente-spark --tgz # Build time of 5:40.12s on my i7-4790K Fire up your custom spark build like any other .\/dist\/bin\/spark-shell Copy the Spark assembly jar to your servers and reboot.",
        "inLanguage" : "en-US",
        "author" : "Joseph Lust",
        "creator" : "Joseph Lust",
        "accountablePerson" : "Joseph Lust",
        "copyrightHolder" : "Joseph Lust",
        "copyrightYear" : "2016",
        "datePublished" : "",
        "publisher": "LustForge.com",
        "logo": "https:\/\/lust.dev\/favicon.png",
        "url" : "https:\/\/lust.dev\/2016\/01\/07\/home-cooked-apache-spark\/",
        "wordCount" : "433",
        "image" : ,
        "keywords" : [ "Scala, Apache Spark" ]
    }
    </script>
    
    


<div itemscope itemtype="http://schema.org/BlogPosting" style="display:none;">
     <meta itemprop="mainEntityOfPage" content="https://lust.dev/2016/01/07/home-cooked-apache-spark/" />
     <meta itemprop="inLanguage" content="en-US" />
     <h1 itemprop="headline">Home Cooked Apache Spark</h1>
     <meta itemprop="name" content="Home Cooked Apache Spark" />
     <meta itemprop="description" content="" />
     <meta itemprop="wordCount" content="433" />
     <meta itemprop="keywords" content="Scala,Apache Spark" />
     
     <meta itemprop="copyrightYear" content="2016" />
    <div itemprop="copyrightHolder" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Joseph Lust">
    </div>
    
    
    
    <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
         <img  itemprop="url" src="https://lust.dev/img/lustforge_key_default.png" alt="thumbnail">
         <meta itemprop="width" content="200" >
         <meta itemprop="height" content="200" >
    </div>
    
    <meta itemprop="datePublished" content="2016-01-07">
    <meta itemprop="dateModified" content="2016-01-07">
    <a itemprop="mainEntityOfPage" href="/ArticleLink"></a>
    <div itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Joseph Lust">
    </div>
    <div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LustForge.com">
      <a itemprop="url" href="/"> 
      <span itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"  >
      <img itemprop="image" src="https://lust.dev/favicon.png" />
      <link itemprop="url" href="https://lust.dev/favicon.png" />
      </span>
      </a>
    </div>
</div>

    

    

<p>We use Apache Spark for various applications at <a href="https://mc10inc.com">my job</a>, but Spark is still relatively unstable, as evidenced by the project&rsquo;s <a href="https://github.com/apache/spark/pulls">11K+</a> pull requests. To maintain developer velocity, we regularly patch show stopper bugs in the Spark source. The process is simple.</p>

<ol>
<li><p>Install JDK 6, which is required for PySpark (or you&rsquo;ll get a lengthy warning). Use the <code>oracle-java8-set-default</code> package to switch between Java 6 and 8, or set <code>JAVA_HOME</code>.</p>

<pre><code class="language-bash">sudo apt-get install oracle-java6-installer
oracle-java8-set-default # Go back to Java 8 when you're done building
</code></pre></li>

<li><p>Fork the <a href="https://github.com/apache/spark">Apache Spark repo</a> so you can submit a Pull Request later</p></li>

<li><p>Clone it locally, checking out your tag of interest</p>

<pre><code class="language-bash">git clone git@github.com:mc10-inc/spark.git special-spark
cd special-spark
git checkout v1.4.1 # Tag of interest
JAVA_HOME=&quot;/usr/lib/jvm/java-6-oracle&quot; # In case you've got 7/8/9 installed
./make-distribution.sh --name al-dente-spark --tgz
# Build time of 5:40.12s on my i7-4790K
</code></pre></li>

<li><p>Fire up your custom spark build like any other</p>

<pre><code class="language-bash">./dist/bin/spark-shell
</code></pre></li>

<li><p>Copy the Spark assembly jar to your servers and reboot. Be sure to remove the old artifact, otherwise the ClassLodaer will load both versions and be vexed.</p>

<pre><code class="language-bash">#Move original assembly to backup location
SPK_PATH=&lt;your spark path&gt;
mv $SPK_PATH/lib/spark-assembly-1.&lt;spark version&gt;-hadoop2.4.0.jar spark-assembly-backup.jar
cp dist/lib/spark-assembly-&lt;spark version&gt;-hadoop2.2.0.jar $SPK_PATH/lib/
./bin/spark-shell # Contact!
</code></pre></li>
</ol>

<h2 id="additional-tricks:4df31c08f441718271b2f3213a675cee">Additional Tricks</h2>

<p>Scala 2.10 is old hat. Most people develop on Scala 2.11, and 2.12 will be released in 2 months. To run Spark on Scala 2.11, you must build it <a href="https://spark.apache.org/docs/latest/building-spark.html#building-for-scala-211">yourself</a>.</p>

<pre><code class="language-bash">./dev/change-scala-version.sh 2.11
./make-distribution.sh --name al-dente-spark --tgz # Build again
</code></pre>

<h3 id="possible-failures:4df31c08f441718271b2f3213a675cee">Possible Failures</h3>

<p>Possible error message below, if you don&rsquo;t use Java 6. I use PySpark, so I need that integration. Why Python needs a version of Java EoL&rsquo;d <a href="http://www.oracle.com/technetwork/java/eol-135779.html">3 years ago</a> is beyond me, but then again, Python 3 split from Python 2 eight years ago.</p>

<pre><code class="language-bash">+ echo '***NOTE***: JAVA_HOME is not set to a JDK 6 installation. The resulting'
***NOTE***: JAVA_HOME is not set to a JDK 6 installation. The resulting
+ echo '            distribution may not work well with PySpark and will not run'
            distribution may not work well with PySpark and will not run
+ echo '            with Java 6 (See SPARK-1703 and SPARK-1911).'
            with Java 6 (See SPARK-1703 and SPARK-1911).
+ echo '            This test can be disabled by adding --skip-java-test.'
            This test can be disabled by adding --skip-java-test.
+ echo 'Output from '\''java -version'\'' was:'
Output from 'java -version' was:
+ echo 'java version &quot;1.8.0_66&quot;
Java(TM) SE Runtime Environment (build 1.8.0_66-b17)
Java HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode)'
java version &quot;1.8.0_66&quot;
Java(TM) SE Runtime Environment (build 1.8.0_66-b17)
Java HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode)
+ read -p 'Would you like to continue anyways? [y,n]: ' -r
</code></pre>

</div>

	
    <div class="comments">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'lustforge';
    var disqus_identifier = 'https:\/\/lust.dev\/2016\/01\/07\/home-cooked-apache-spark\/';
    var disqus_title = 'Home Cooked Apache Spark';
    var disqus_url = 'https:\/\/lust.dev\/2016\/01\/07\/home-cooked-apache-spark\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
                 <a href="/tags/scala/">Scala</a>
            
                 <a href="/tags/apache-spark/">Apache Spark</a>
            
	    <a href="/tags/">[all]</a>
        </p>
    

    <div class="share">
        <a class="icon-twitter" href="https://twitter.com/share?text=Home%20Cooked%20Apache%20Spark&url=https%3a%2f%2flust.dev%2f2016%2f01%2f07%2fhome-cooked-apache-spark%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flust.dev%2f2016%2f01%2f07%2fhome-cooked-apache-spark%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2flust.dev%2f2016%2f01%2f07%2fhome-cooked-apache-spark%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>

    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="lust.dev" href="https://lust.dev/">lust.dev</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2009 - 2018 / Powered by <a href="http://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/twistedpair/ghostwriter">Lustwriter theme</a> By J. Lust</span>
                    <span>/ Forked from <a href="https://github.com/jbub/ghostwriter">Ghostwriter</a></span>
                </p>
            </div>
        </footer>

        <script src="https://lust.dev/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="https://lust.dev/js/jquery.fitvids.js"></script>
        <script src="https://lust.dev/js/scripts.js"></script>
    </body>
</html>

