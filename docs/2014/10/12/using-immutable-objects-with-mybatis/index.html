<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Using Immutable Objects with MyBatis &middot; Joseph Lust</title>
        <meta name="description" content="drive to develop">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.16-DEV" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="https://lust.dev/favicon.png">
        <link rel="stylesheet" href="https://lust.dev/css/normalize.css">
	<link rel="stylesheet" href="https://lust.dev/css/highlight/obsidian.css">
        <link rel="stylesheet" href="https://lust.dev/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        
        

            
            <meta property="og:type"   content="article" />
            <meta property="og:url"    content="https://lust.dev/2014/10/12/using-immutable-objects-with-mybatis/" />
            <meta property="og:title"  content="Using Immutable Objects with MyBatis" />

            <meta name="twitter:domain" value="lustforge.com" />
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:title" value="Using Immutable Objects with MyBatis" />
            

            
            <meta name="twitter:url" value="https://lust.dev/2014/10/12/using-immutable-objects-with-mybatis/"/>

            
        
        
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17498476-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="lust.dev" href="https://lust.dev/">lust.dev</a>
                            </h1>
                        
			
                        	<a class="button-square" href="https://lust.dev/index.xml"><i title="RSS Feed" class="fa fa-rss"></i></a>
			
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/lustcoder">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/twistedpair">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href="https://stackoverflow.com/users/564157/joseph-lust">
                                <i class="fa fa-stack-overflow"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://www.linkedin.com/in/josephlust">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
			
			<h1 class="site-title" style="margin-left:10px;">
                            <a class="site-title" data-hint="Lust" title="Meet the groundskeeper" href="https://lust.dev/about/">J. Lust &#8250;</a>
                        </h1>
                    </div>

                    <ul class="site-nav">
                        
                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">Using Immutable Objects with MyBatis</h1>
    
</header>

        
<div class="post-content clearfix">

        
    
    
    <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "articleSection" : "post",
        "name" : "Using Immutable Objects with MyBatis",
        "headline" : "Using Immutable Objects with MyBatis",
        "description" : "Immutable is Beautiful I\x26#8217;m a fan of immutable objects. We all know the benefits; simple, no mutators, thread safe, cache word optimizable. However, I see far too many MyBatis (and iBatis) developers adding no arg constructors to their POJO\x26#8217;s simply so that MyBatis can reflect and set all of the values into the field setters. I\x26#8217;ll ask \x26#8220;why does this POJO need to be mutated\x26#8221; and they quip that it doesn\x26#8217;t, but these setters and protected no-arg constructors are needed by MyBatis.",
        "inLanguage" : "en-US",
        "author" : "Joseph Lust",
        "creator" : "Joseph Lust",
        "accountablePerson" : "Joseph Lust",
        "copyrightHolder" : "Joseph Lust",
        "copyrightYear" : "2014",
        "datePublished" : "",
        "publisher": "LustForge.com",
        "logo": "https:\/\/lust.dev\/favicon.png",
        "url" : "https:\/\/lust.dev\/2014\/10\/12\/using-immutable-objects-with-mybatis\/",
        "wordCount" : "422",
        "image" : ,
        "keywords" : [ "iBatis, MyBatis" ]
    }
    </script>
    
    


<div itemscope itemtype="http://schema.org/BlogPosting" style="display:none;">
     <meta itemprop="mainEntityOfPage" content="https://lust.dev/2014/10/12/using-immutable-objects-with-mybatis/" />
     <meta itemprop="inLanguage" content="en-US" />
     <h1 itemprop="headline">Using Immutable Objects with MyBatis</h1>
     <meta itemprop="name" content="Using Immutable Objects with MyBatis" />
     <meta itemprop="description" content="" />
     <meta itemprop="wordCount" content="422" />
     <meta itemprop="keywords" content="iBatis,MyBatis" />
     
     <meta itemprop="copyrightYear" content="2014" />
    <div itemprop="copyrightHolder" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Joseph Lust">
    </div>
    
    
    
    <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
         <img  itemprop="url" src="https://lust.dev/img/lustforge_key_default.png" alt="thumbnail">
         <meta itemprop="width" content="200" >
         <meta itemprop="height" content="200" >
    </div>
    
    <meta itemprop="datePublished" content="2014-10-12">
    <meta itemprop="dateModified" content="2014-10-12">
    <a itemprop="mainEntityOfPage" href="/ArticleLink"></a>
    <div itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Joseph Lust">
    </div>
    <div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lust.dev">
      <a itemprop="url" href="/"> 
      <span itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"  >
      <img itemprop="image" src="https://lust.dev/favicon.png" />
      <link itemprop="url" href="https://lust.dev/favicon.png" />
      </span>
      </a>
    </div>
</div>

    

    

<h3 id="immutable-is-beautiful:d90d602dac8d4ebcf6da451e2175ba06">Immutable is Beautiful</h3>

<p>I&#8217;m a fan of immutable objects. We all know the benefits; simple, no mutators, thread safe, cache word optimizable. However, I see far too many MyBatis (and iBatis) developers adding no arg constructors to their POJO&#8217;s simply so that MyBatis can reflect and set all of the values into the field setters. I&#8217;ll ask &#8220;<em>why does this POJO need to be mutated</em>&#8221; and they quip that it doesn&#8217;t, but these setters and protected no-arg constructors are needed by MyBatis. This violates my principle that you make your library work with your code, not the other way around.</p>

<p>Given the lack of good documentation on immutable objects in MyBatis, I hope the following helps folks.</p>

<h3 id="example-implementation:d90d602dac8d4ebcf6da451e2175ba06">Example Implementation</h3>

<p>We need a <strong>ResultMap</strong> that will tell MyBatis how to map this to a constructor. This is because Java reflection only exposes the constructor parameter types and order, not the names of the parameters (so claim <a title="Claims!" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#constructor" target="_blank">the MyBatis docs</a>, though Spring somehow manages to <a title="Proof!" href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/beans.html#beans-factory-ctor-arguments-resolution" target="_blank">do this with bean constructors</a>&#8230;).</p>

<p>The mapper maps the column names returned in the query to the types on the constructor. It also lays out the order of the arguments. Make sure the constructor argument order exactly matches that of your POJO.</p>

<p><strong>Note:</strong> underscores before types map to the primitive value. <strong>_long</strong> maps to the primitive long type. <strong>long</strong> maps to the wrapper type <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Long.html" target="_blank">java.lang.Long</a>.</p>

<pre><code class="language-xml">&lt;resultMap  id=&quot;fooViewMap&quot; type=&quot;com.lustforge.FooView&quot;&gt;
	&lt;constructor&gt;
		&lt;arg column=&quot;id&quot; javaType=&quot;_long&quot;/&gt;
		&lt;arg column=&quot;is_dirty&quot;	javaType=&quot;_boolean&quot;/&gt;
	&lt;/constructor&gt;
&lt;/resultMap&gt;
</code></pre>

<p>Now make sure your query block points to the mapper via its <strong>resultMap</strong> attribute. Again confirm that the column names returned <strong>exactly match those in the map</strong>. <strong>Note:</strong> the order does not need to match for the query.</p>

<pre><code class="language-xml">&lt;select id=&quot;getFooViews&quot; resultMap=&quot;fooViewMap&quot;&gt;
  &lt;![CDATA[
	    SELECT 
   		foo.id
   		foo.is_dirty

		FROM foo
		-- your query here
	 ]]&gt;
&lt;/select&gt;
</code></pre>

<p>Finally make sure your POJO constructor matches. It&#8217;s also a good idea to leave a note to future developers to update MyBatis if they alter the constructor argument types or order.</p>

<pre><code class="language-java">public final class FooView {

	private final long id;
	private final boolean isDirty;

	// Prescient comment
	// NOTE: MyBatis depends on parameter order and type for object creation
	// If you change the constructor, update the MyBatis mapper
	public FooView(long id, boolean isDirty) {
	    super();
	    this.id = id;
	    this.isDirty = isDirty;
	}

	public long getId() {
	    return id;
	}

	public boolean isDirty() {
	    return isDirty;
	}
	
	// ... don't forget equals/hashcode and toString as well
}
</code></pre>

<p>That was easy and now you&#8217;re using best practices. Pat yourself on the back and get busy with your new immutable POJO.</p>

</div>

	
    <div class="comments">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'lustforge';
    var disqus_identifier = 'https:\/\/lust.dev\/2014\/10\/12\/using-immutable-objects-with-mybatis\/';
    var disqus_title = 'Using Immutable Objects with MyBatis';
    var disqus_url = 'https:\/\/lust.dev\/2014\/10\/12\/using-immutable-objects-with-mybatis\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
                 <a href="/tags/ibatis/">iBatis</a>
            
                 <a href="/tags/mybatis/">MyBatis</a>
            
	    <a href="/tags/">[all]</a>
        </p>
    

    <div class="share">
        <a class="icon-twitter" href="https://twitter.com/share?text=Using%20Immutable%20Objects%20with%20MyBatis&url=https%3a%2f%2flust.dev%2f2014%2f10%2f12%2fusing-immutable-objects-with-mybatis%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flust.dev%2f2014%2f10%2f12%2fusing-immutable-objects-with-mybatis%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2flust.dev%2f2014%2f10%2f12%2fusing-immutable-objects-with-mybatis%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>

    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="lust.dev" href="https://lust.dev/">lust.dev</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2009 - 2018 / Powered by <a href="http://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/twistedpair/ghostwriter">Lustwriter theme</a> By J. Lust</span>
                    <span>/ Forked from <a href="https://github.com/jbub/ghostwriter">Ghostwriter</a></span>
                </p>
            </div>
        </footer>

        <script src="https://lust.dev/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="https://lust.dev/js/jquery.fitvids.js"></script>
        <script src="https://lust.dev/js/scripts.js"></script>
    </body>
</html>

