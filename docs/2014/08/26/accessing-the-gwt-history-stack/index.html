<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Accessing the GWT History Stack &middot; Joseph Lust</title><meta name=description content="drive to develop"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.59.1"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://lust.dev/favicon.png><link rel=stylesheet href=https://lust.dev/css/normalize.css><link rel=stylesheet href=https://lust.dev/css/highlight/obsidian.css><link rel=stylesheet href=https://lust.dev/css/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><meta property="og:type" content="article"><meta property="og:url" content="https://lust.dev/2014/08/26/accessing-the-gwt-history-stack/"><meta property="og:title" content="Accessing the GWT History Stack"><meta name=twitter:domain value=lustforge.com><meta name=twitter:card content="summary_large_image"><meta name=twitter:title value="Accessing the GWT History Stack"><meta name=twitter:url value=https://lust.dev/2014/08/26/accessing-the-gwt-history-stack/></head><body><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-17498476-1','auto');ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=lust.dev href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml><i title="RSS Feed" class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/lustcoder><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/twistedpair><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust><i class="fa fa-stack-overflow"></i></a><a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/josephlust><i class="fa fa-linkedin"></i></a><h1 class=site-title style=margin-left:10px><a class=site-title data-hint=Lust title="Meet the groundskeeper" href=https://lust.dev/about/>J. Lust &#8250;</a></h1></div><ul class=site-nav></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Accessing the GWT History Stack</h1><p class=post-date><span>Published <time datetime=2014-08-26 itemprop=datePublished>Tue, Aug 26, 2014</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=http://schema.org/Person><span itemprop=name><a href=https://stackoverflow.com/users/564157/joseph-lust itemprop=url rel=author>Joseph Lust</a></span></span></p></header><div class="post-content clearfix" itemprop=articleBody><p>GWT (Google Web Toolkit) does not supply a direct way to know where users have been within your application. However, you can use a simple listener and stack to record and access history events.</p><p>The key is the GWT History object. You can listen to its change event to know the user has gone to another Place. The restriction is <a href="https://groups.google.com/forum/?fromgroups=#!topic/google-web-toolkit/ypofMT1wsXo" target=_blank>we don&#8217;t know when the user has gone <strong>back</strong></a>. This is an inherent state detection problem in the stateless HTTP web. Ideally, it should not matter to your application how a user arrived at the given Place.</p><p>We&#8217;ll start with an interface to define our new class&#8217; contracts. There is a 16 step limit since we don&#8217;t want to keep filling memory with history locations. I&#8217;ve added a method to get the last 16 and to get the last place as well.</p><pre><code class=language-java>/**
 * Stack that tracks browser history interactions
 */
public interface HistoryStack { 

    /**
    * Get up to the last 16 history events. 0 index is the last visited.
    * @return
    */
    String[] getStack(); 

    /**
    * Return the last event, if any. Is not the current place, but current -1
    * @return NULL if no history
    */
    String getLast();
}
</code></pre><p>Now for the implementation. Oddly, since we cannot track back events, we can&#8217;t really use this as a stack, but rather are placing Places in a fixed size queue. Instead than switch to a queue, I&#8217;ve stuck with a stack, which is the classic structure for this use case. Folks might get confused if they saw a &#8220;HistoryQueue.&#8221;</p><pre><code class=language-java>/**
 * Create a stack that updates as we navigate, tracking history
 */
@Singleton
public class HistoryStackImpl implements HistoryStack, ValueChangeHandler&amp;lt;String&amp;gt; { 

    private static final int MAX_LENGTH = 16;

    private final Stack&amp;lt;String&amp;gt; stack = new Stack&amp;lt;String&amp;gt;(); 

    // Instantiate via Gin  
    protected HistoryStackImpl() { 
        History.addValueChangeHandler(this);
    } 

    @Override 
    public void onValueChange(ValueChangeEvent&amp;lt;String&amp;gt; event) {
        
        // only store max elements
        if(stack.size() &amp;gt; MAX_LENGTH) {
                stack.remove(0);
        }
        stack.push(event.getValue()); 
    }

    @Override
    public String[] getStack() {
        // reverse stack so first entry of array is last visited
        // return defensive copy
        final String[] arr = new String[stack.size()];
        int i=0;
        for(int n=stack.size()-1; n&amp;gt;=0; n--) {
                arr[i] = stack.get(n);
                i++;
        }
        return arr;
    }

    @Override
    public String getLast() {
        // null no prior location
        if(stack.size()&amp;lt;2) {
                return null;
        }
        return stack.get(stack.size()-2);
    } 
}
</code></pre><p>Finally we&#8217;ll tell Gin to ginject this into our application for use, starting it up when the app loads.</p><pre><code class=language-java>public class MyClientModule extends AbstractPresenterModule {

    @Override
    protected void configure() {

        bind(HistoryStack.class)
            .to(HistoryStackImpl.class)
            .asEagerSingleton(); // history from startup //... 
</code></pre><p>Now that was easy. Just inject your history stack into any presenter than needs to make history bases decisions. In my case, I had a user setting editor. I wanted the &#8220;Done&#8221; button to go back to the Place the user was last on so they could continue their work there, or if they started the app on the Settings page, to take them to the home page. This hack fit the bill perfectly. I hope it does the same for you.</p><p>P.S. I must give credit to <strong>dindeman</strong> for the <a href="https://groups.google.com/forum/?fromgroups=#!searchin/gwt-platform/history$20stack/gwt-platform/RT8BT_aLA2k/G0dtCEnW2SYJ" target=_blank>initial revision</a>.</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=../../../../tags/google-gin/>Google Gin</a>
<a href=../../../../tags/google-web-toolkit-gwt/>Google Web Toolkit (GWT)</a>
<a href=../../../../tags/>[all]</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Accessing%20the%20GWT%20History%20Stack&url=https%3a%2f%2flust.dev%2f2014%2f08%2f26%2faccessing-the-gwt-history-stack%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flust.dev%2f2014%2f08%2f26%2faccessing-the-gwt-history-stack%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a>
<a class=icon-google-plus href="https://plus.google.com/share?url=https%3a%2f%2flust.dev%2f2014%2f08%2f26%2faccessing-the-gwt-history-stack%2f" onclick="window.open(this.href,'google-plus-share','width=490,height=530');return false;"><i class="fa fa-google-plus"></i><span class=hidden>Google+</span></a></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"lustforge"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=lust.dev href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2009 - 2018 / Powered by <a href=http://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/twistedpair/ghostwriter>Lustwriter theme</a> By J. Lust</span>
<span>/ Forked from <a href=https://github.com/jbub/ghostwriter>Ghostwriter</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script src=https://lust.dev/js/jquery.fitvids.js></script><script src=https://lust.dev/js/scripts.js></script></body></html>