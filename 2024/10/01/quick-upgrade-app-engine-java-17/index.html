<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Quick Upgrade Trick for App Engine Java 17 &#183;</title><meta name=description content="Quickly modernize your App Engine Java 8 codebase to run on Java 17!"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.152.2"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Quick Upgrade Trick for App Engine Java 17"><meta property="og:description" content="Quickly modernize your App Engine Java 8 codebase to run on Java 17!"><meta property="og:type" content="article"><meta property="og:url" content="https://lust.dev/2024/10/01/quick-upgrade-app-engine-java-17/"><link rel=stylesheet href=https://lust.dev/dist/site.css><link rel=stylesheet href=https://lust.dev/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://lust.dev//css/font-awesome-all.min.css><meta name=twitter:image content="/img/app-engine-turbo-jet.webp"><meta property="og:image" content="/img/app-engine-turbo-jet.webp"></head><body><script async src="https://www.googletagmanager.com/gtag/js?id=G-W625CVG5Q9"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W625CVG5Q9")}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class=button-square href=https://lust.dev/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Bluesky aria-label=bluesky href=https://bsky.app/profile/lust.dev rel=me><i class="fa-brands fa-bluesky" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/twistedpair rel=me><i class="fa-brands fa-github-alt" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint="Stack Overflow" aria-label="Stack Overflow" href=https://stackoverflow.com/users/564157/joseph-lust rel=me><i class="fa-brands fa-stack-overflow" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://linkedin.com/in/josephlust rel=me><i class="fa-brands fa-linkedin" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=../../../../>Blog</a></li><li class=site-nav-item><a href=../../../../gcloud>gcloud</a></li><li class=site-nav-item><a href=../../../../tags>Tags</a></li><li class=site-nav-item><a href=../../../../about>About J. Lust</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Quick Upgrade Trick for App Engine Java 17</h1><p class=post-date><span>Published <time datetime=2024-10-01 itemprop=datePublished>1 Oct '24</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=# itemprop=url rel=author>Joe Lust</a></span></span></p><p class="post-reading post-line"><span>‚è∞ 6 min read</span></p></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=../../../../img/java-17-upgrade.webp><p>Java modernization is sweeping over Google Cloud App Engine üéâ. While Java 8 support dates back to <a href=https://cloud.google.com/appengine/docs/legacy/standard/java/release-notes#August_14_2015>circa 2015</a>, after many <a href="https://issuetracker.google.com/issues/145762507?pli=1">+1 votes</a> the feature was delivered to App Engine Flex <a href=https://cloud.google.com/appengine/docs/standard/java-gen2/release-notes#August_14_2015>in 2022</a>. Now however comes the deprecation reckoning. Java 8 must go, as well as Java 11 shortly thereafter.</p><p>If you&rsquo;ve seen this error message, this article is for you:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ERROR: <span class=o>(</span>gcloud.app.deploy<span class=o>)</span> INVALID_ARGUMENT: Error<span class=o>(</span>s<span class=o>)</span> encountered validating runtime. Your runtime version <span class=k>for</span> java is past End of Support. Please upgrade to the latest runtime version available..
</span></span></code></pre></div><p>Fear not, your app will keep running during <a href=https://cloud.google.com/appengine/docs/flexible/lifecycle/runtime-lifecycle#end_of_support>End of Support</a>, but it&rsquo;ll be completely <a href=https://cloud.google.com/appengine/docs/flexible/lifecycle/support-schedule#java>impossible to update or redeploy</a> after <strong>2025-07-10</strong> and <strong>2025-10-31</strong> respectively for Java 8 and Java 11. Since your boss and users probably like the idea of deploying updates, and getting Google Cloud security updates, it&rsquo;s best to get your upgrade on.</p><p>Easy peasy, right? Not exactly. We now need to bring our own web server as we don‚Äôt get everything for free from App Engine. This is both a challenge and a benefit, as now you‚Äôve got more control over the code you‚Äôre running. Before you worry about rearchitecting your app, let me share a little known trick that can make this upgrade quite simple and easy üòÅ.</p><h2 id=ride-the-whale>Ride the Whale</h2><p>Ready for it? <strong>Just use a container!</strong></p><p>You‚Äôre scratching your head, right? I bet you thought that <a href=https://cloud.google.com/appengine/docs/flexible/java/runtime>Java on App Engine Flex</a> is just for running Java apps. Touche! App Engine can run containers now to, meaning you don‚Äôt need to use <a href=https://cloud.google.com/kubernetes-engine>Google Kubernetes Engine</a> or <a href=https://cloud.google.com/run>Google Cloud Run</a> to execute a custom containerized server. As I said, we don‚Äôt need to rearchitect your app or move it to a new service, we can just deploy with <code>--image-url &lt;URL></code> (see the <a href=https://cloud.google.com/sdk/gcloud/reference/app/deploy#--image-url>command details</a>) and we‚Äôre back in business!</p><h2 id=lets-upgrade-this-java-app>Let‚Äôs Upgrade This Java App</h2><p>Here‚Äôs some examples of how to easily upgrade your app.</p><h3 id=build-a-container>Build a Container</h3><p>We‚Äôll use a Jetty container. Why Jetty? Because it‚Äôs the app server that App Engine Flex <a href=https://groups.google.com/g/google-appengine/c/7hhJnR8Uj0Y/m/8bqFInjEAAAJ>used internally</a> for Java 8. Lucky for us, there‚Äôs a <a href=https://hub.docker.com/_/jetty>Jetty image on Dockerhub</a> that we can use. I‚Äôm using the Temurin JRE here, since the Oracle JRE is license encumbered, and OpenJDK isn‚Äôt as well maintained.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c># Dockerfile</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Use Jetty 9 or 11 - depending on what your app supports (change :9 to :11 below)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=w> </span><span class=s>jetty:9-jre17-eclipse-temurin</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Set the WORKDIR, further commands will run in this context</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Set any custom server configurations in your server.ini files - OPTIONAL if you&#39;re not customizing Jetty</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> server.ini /var/lib/jetty/start.d/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy in your classic WAR file you used to deploy to App Engine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> server.war /var/lib/jetty/webapps/ROOT.war<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span> <span class=s2>&#34;-c&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># JETTY_BASE &amp; JETTY_HOME are set by base image</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># PORT is set by App Engine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># org.eclipse.jetty.servlet.Default.dirAllowed=false is a security hardening measure</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=o>[</span><span class=s2>&#34;java \
</span></span></span><span class=line><span class=cl><span class=s2>    -Djetty.base=</span><span class=nv>$JETTY_BASE</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    -Djetty.http.port=</span><span class=si>${</span><span class=nv>PORT</span><span class=k>:-</span><span class=nv>8080</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    -Dorg.eclipse.jetty.servlet.Default.dirAllowed=false \
</span></span></span><span class=line><span class=cl><span class=s2>    -Dfile.encoding=UTF-8 \
</span></span></span><span class=line><span class=cl><span class=s2>    -jar </span><span class=nv>$JETTY_HOME</span><span class=s2>/start.jar --module=http&#34;</span><span class=o>]</span><span class=err>
</span></span></span></code></pre></div><h3 id=ensure-things-run-on-java-1117>Ensure Things Run on Java 11/17</h3><p>This is the tricky part, and I can&rsquo;t help you there, but since you&rsquo;ve got a containerized Java app + server now, you can just run it and see what breaks.
Code fix, build, re-run. It&rsquo;s a quick dev/test iteration cycle.</p><p>For example, you can now run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t my-java-17-app-server .
</span></span><span class=line><span class=cl>docker run --rm my-java-17-app-server
</span></span></code></pre></div><p>Good luck there. Just use Stackoverflow and the LLM of your choice to chase down any issues you bump into.</p><h3 id=push-your-app-container-up-to-the-cloud>Push your App Container Up to the Cloud</h3><p>Once things are looking good, you can just push this image to <a href=https://cloud.google.com/artifact-registry>Google Artifact Registry</a>.
That might look something like</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud auth configure-docker us-docker.pkg.dev
</span></span><span class=line><span class=cl>docker tag my-java-17-app-server us-docker.pkg.dev/YOUR-PROJECT/YOUR-REPO/my-java-17-app-server
</span></span><span class=line><span class=cl>docker push us-docker.pkg.dev/YOUR-PROJECT/YOUR-REPO/my-java-17-app-server
</span></span></code></pre></div><p>In the above example <code>us-docker.pkg.dev/YOUR-PROJECT/YOUR-REPO/my-java-17-app-server</code> will be the <code>--image-url</code> parameter you&rsquo;ll set when deploying your app with <code>gcloud</code>.</p><h3 id=bump-your-app-java-version>Bump Your App Java Version</h3><p>Additionally, we want to make sure we‚Äôre running on Java 17 in Google Cloud, since <a href=https://cloud.google.com/appengine/docs/flexible/lifecycle/support-schedule#java>Java 11 will be end of support</a> on Halloween 2024 per the <a href=https://cloud.google.com/appengine/docs/flexible/lifecycle/runtime-lifecycle>deprecation lifecycle</a>. These changes will make App Engine use Java 17. Update your <a href=https://cloud.google.com/appengine/docs/flexible/java/runtime><code>app.yaml</code> file</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># app.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>runtime_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>operating_system</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>runtime_version</span><span class=p>:</span><span class=w> </span><span class=m>17</span><span class=w>
</span></span></span></code></pre></div><h3 id=will-it-blend-deploy-to-app-engine>Will it Blend? Deploy to App Engine</h3><p>Final step, will your container boot and run in App Engine on Java 17?
Let&rsquo;s take one precaution here. If you&rsquo;re post <a href=https://cloud.google.com/appengine/docs/flexible/lifecycle/support-schedule#java>End of Service date</a> for your existing app&rsquo;s Java runtime, you <strong>can no longer deploy your app</strong>. That means that your app might still be running happily in the cloud, but now we&rsquo;ll deploy a broken version over it. Not good.</p><p>So, I&rsquo;d suggest either deploying a new canary app (just deploy a temporary App Engine app that you&rsquo;ll take down later), or only push this <em>new</em> version to App Engine, but don&rsquo;t cut over traffic to it yet, using App Engine <a href=https://cloud.google.com/appengine/docs/flexible/splitting-traffic>traffic splitting</a>. Remember that you can still access a non-production serving version of your running app using the <a href="https://cloud.google.com/appengine/docs/standard/how-requests-are-routed?tab=python">per-version URL syntax</a> in App Engine.</p><p>Deploying your new and improved app would look something like the following, though you probably have extra flags you&rsquo;re using in your CI/CD deployment scripts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Set YOUR-NEW-APP-VERSION to a version name (arbitrary string) that differentiates this release from others</span>
</span></span><span class=line><span class=cl><span class=c1># then your can access it via the version specific URLs mentioned above</span>
</span></span><span class=line><span class=cl><span class=c1># Set CONTAINER_IMAGE_URL to the tag we pushed to Cloud Artifact Registry earlier in the article</span>
</span></span><span class=line><span class=cl>gcloud app deploy app.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --project YOUR-PROJECT <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --version<span class=o>=</span>YOUR-NEW-APP-VERSION <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --no-stop-previous-version <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --image-url<span class=o>=</span>CONTAINER_IMAGE_URL <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --no-promote
</span></span></code></pre></div><p>Note that the above config won&rsquo;t replace the existing serving code, so if it breaks, you&rsquo;ll be able to review the <a href="https://cloud.google.com/appengine/docs/flexible/writing-application-logs?tab=java#view_logs">App Engine Flex logs</a> to see what went wrong.</p><p>Did it run? Nice work. You&rsquo;ve got JVM ninja skillz now.</p><h1 id=conclusions>Conclusions</h1><p>There are various ways to migrate from Java 8 to Java 11, 17 and beyond (anyone say 21?) in App Engine Flex today. This includes <a href=https://cloud.google.com/docs/buildpacks/overview>buildpacks</a>, and the <a href=https://cloud.google.com/appengine/docs/flexible/java/using-gradle>App Engine Gradle plugin</a>. While these are useful for green field Java projects, <em>many many</em> Java apps in the wild are using older Java runtimes and are simply being maintained rather than actively developed. For these cases, the easiest way to upgrade Java versions on App Engine is to simply build the containers mentioned above.</p><p>In short, it boils down to:</p><ol><li>Ensuring your code will run on Java 17 (or higher)</li><li>Building a container image w/ a built in app server and copying in your compiled WAR file</li><li>Pushing this container to Cloud Artifact Registry</li><li>Bumping the Java runtime version in your <code>app.yaml</code> file</li><li>Deploying to the newer runtime and ensuring the lights come on</li></ol><p><strong>Congrats</strong>, you&rsquo;re on Java 17, which is <a href=https://cloud.google.com/appengine/docs/flexible/lifecycle/support-schedule#java>supported</a> by App Engine until <strong>October 2027</strong>.
Take it easy, <em>or</em> be an overachiever and move on to Java 21 which is supported until <strong>October 2031</strong> üòâ.</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=../../../../tags/app-engine/>app-engine</a>,
<a href=../../../../tags/app-engine-flex/>app-engine-flex</a>,
<a href=../../../../tags/serverless/>serverless</a>,
<a href=../../../../tags/google-cloud-platform/>google-cloud-platform</a>,
<a href=../../../../tags/cloud/>cloud</a>,
<a href=../../../../tags/upgrade/>upgrade</a>,
<a href=../../../../tags/java/>java</a>,
<a href=../../../../tags/java-8/>java-8</a>,
<a href=../../../../tags/java-11/>java-11</a>,
<a href=../../../../tags/java-17/>java-17</a></p></footer><div class=comments><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://lust.dev/2024/10/01/quick-upgrade-app-engine-java-17/",this.page.identifier="/2024/10/01/quick-upgrade-app-engine-java-17/"};(function(){var e=document,t=e.createElement("script");t.src="https://lustforge.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://lust.dev/>lust.dev</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2026 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://lust.dev/js/jquery-1.11.3.min.js></script><script src=https://lust.dev/js/jquery.fitvids.js></script><script src=https://lust.dev/js/scripts.js></script></body></html>